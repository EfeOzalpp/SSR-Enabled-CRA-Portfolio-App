{"version":3,"file":"src_ssr_projects_game_enhancer_tsx.server.js","mappings":"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","sources":["webpack://personal-site/./src/components/rock-escapade/block-g-onboarding-inner.tsx","webpack://personal-site/./src/ssr/projects/game.enhancer.tsx"],"sourcesContent":["// src/components/rock-escapade/block-g-onboarding-inner.tsx\r\nimport React, { useEffect, useRef } from 'react';\r\nimport lottie from 'lottie-web';\r\nimport onboardingAnimation from '../../svg/coin.json';\r\n\r\ntype InnerProps = {\r\n  onClick?: () => void;\r\n  onMount?: () => void;\r\n  onUnmount?: () => void;\r\n  startAtFrame?: number;\r\n  loopFromFrame?: number;\r\n  debug?: boolean;\r\n  label?: string;\r\n  ctaEnabled?: boolean;\r\n};\r\n\r\ntype Phase = 'intro' | 'tail';\r\n\r\nconst BlockGOnboardingInner: React.FC<InnerProps> = ({\r\n  onClick,\r\n  onMount,\r\n  onUnmount,\r\n  startAtFrame = 0,\r\n  loopFromFrame = 41,\r\n  debug = false,\r\n  label = 'Click Here to Play!',\r\n}) => {\r\n  const hostRef = useRef<HTMLDivElement | null>(null);\r\n  const animRef = useRef<ReturnType<typeof lottie.loadAnimation> | null>(null);\r\n  const phaseRef = useRef<Phase>('intro');\r\n  const introDoneRef = useRef(false);\r\n  const absEndRef = useRef<number>(0);\r\n\r\n  // keep callbacks stable for the effect\r\n  const mountRef = useRef(onMount);\r\n  const unmountRef = useRef(onUnmount);\r\n  useEffect(() => { mountRef.current = onMount; }, [onMount]);\r\n  useEffect(() => { unmountRef.current = onUnmount; }, [onUnmount]);\r\n\r\n  const log = (...a: any[]) => debug && console.log('[Coin]', ...a);\r\n\r\n  useEffect(() => {\r\n    mountRef.current?.();\r\n    const el = hostRef.current;\r\n    if (!el) return () => unmountRef.current?.();\r\n\r\n    // clean any prior\r\n    try { animRef.current?.destroy(); } catch {}\r\n    animRef.current = null;\r\n    phaseRef.current = 'intro';\r\n    introDoneRef.current = false;\r\n\r\n    const anim = lottie.loadAnimation({\r\n      container: el,\r\n      renderer: 'svg',\r\n      loop: false,\r\n      autoplay: false,\r\n      animationData: onboardingAnimation,\r\n      rendererSettings: {\r\n        preserveAspectRatio: 'xMidYMid meet',\r\n        progressiveLoad: true,\r\n      },\r\n    });\r\n    animRef.current = anim;\r\n\r\n    const getAbsEnd = () => {\r\n      const frames = Math.max(1, Math.floor((anim as any).getDuration?.(true) ?? anim.totalFrames ?? 1));\r\n      return frames - 1;\r\n    };\r\n\r\n    const playIntroOnce = () => {\r\n      const absEnd = absEndRef.current;\r\n      const s = Math.max(0, Math.min(startAtFrame, absEnd));\r\n      log('intro start', { startAtFrame: s, absEnd });\r\n      anim.goToAndStop(s, true);\r\n      anim.playSegments([s, absEnd], true);\r\n    };\r\n\r\n    const startTailLoop = () => {\r\n      if (phaseRef.current === 'tail') return;\r\n      phaseRef.current = 'tail';\r\n      const absEnd = absEndRef.current;\r\n      const tailStart = Math.max(0, Math.min(loopFromFrame, absEnd));\r\n      anim.removeEventListener('complete', onCompleteIntro);\r\n      anim.loop = true;\r\n      anim.playSegments([tailStart, absEnd], true);\r\n      log('→ tail loop', { tailStart, absEnd });\r\n    };\r\n\r\n    const onDOMLoaded = () => {\r\n      absEndRef.current = getAbsEnd();\r\n      log('DOMLoaded', { absEnd: absEndRef.current });\r\n      playIntroOnce();\r\n    };\r\n\r\n    const onCompleteIntro = () => {\r\n      if (!introDoneRef.current) {\r\n        introDoneRef.current = true;\r\n        log('intro complete', { frame: Math.floor(anim.currentFrame || 0) });\r\n        startTailLoop();\r\n      }\r\n    };\r\n\r\n    const onLoopComplete = () => {\r\n      if (phaseRef.current === 'tail') {\r\n        log('loopComplete (tail)', { frame: Math.floor(anim.currentFrame || 0) });\r\n      }\r\n    };\r\n\r\n    anim.addEventListener('DOMLoaded', onDOMLoaded);\r\n    anim.addEventListener('complete', onCompleteIntro);\r\n    anim.addEventListener('loopComplete', onLoopComplete);\r\n\r\n    return () => {\r\n      log('destroy');\r\n      try {\r\n        anim.removeEventListener('DOMLoaded', onDOMLoaded);\r\n        anim.removeEventListener('complete', onCompleteIntro);\r\n        anim.removeEventListener('loopComplete', onLoopComplete);\r\n        anim.destroy();\r\n      } catch {}\r\n      animRef.current = null;\r\n      unmountRef.current?.();\r\n    };\r\n    // Only re-init when these truly need to change:\r\n  }, [startAtFrame, loopFromFrame, debug]);\r\n\r\n  return (\r\n    <>\r\n      <div ref={hostRef} className=\"coin\" onClick={onClick} style={{ pointerEvents: 'auto' }} />\r\n      <h1 className=\"onboarding-text\" onClick={onClick} style={{ pointerEvents: 'auto' }}>\r\n        {label}\r\n      </h1>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default BlockGOnboardingInner;\r\n","// src/ssr/projects/game.enhancer.tsx\r\nimport React, { useEffect, useMemo, useRef, useState, useCallback } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport lottie from 'lottie-web';\r\n\r\nimport BlockGOnboarding from '../../components/rock-escapade/block-g-onboarding-inner';\r\nimport ExitButton from '../../components/rock-escapade/block-g-exit';\r\nimport CoinCounter from '../../components/rock-escapade/block-g-coin-counter';\r\nimport GameOverController from '../logic/game-over-controller';\r\n\r\nimport { useRealMobileViewport } from '../../utils/content-utility/real-mobile';\r\nimport LazyViewMount from '../../utils/content-utility/lazy-view-mount';\r\nimport { gameLoaders } from '../../utils/content-utility/component-loader';\r\nimport { useHighScoreSubscription } from '../../components/rock-escapade/useHighScoreSubscription';\r\n\r\nimport GameInputGuards from '../logic/game-input-guards';\r\n\r\nimport desktopOnboarding from '../../svg/desktop-onboarding.json';\r\nimport mobileOnboarding from '../../svg/mobile-onboarding.json';\r\n\r\nimport '../../styles/block-type-g.css';\r\n\r\nconst GAME_MODE_CLASS = 'game-mode-active';\r\nconst activateGameMode = () => document.body.classList.add(GAME_MODE_CLASS);\r\nconst deactivateGameMode = () => document.body.classList.remove(GAME_MODE_CLASS);\r\n\r\nfunction scheduleIdle(cb: () => void, timeout = 2000) {\r\n  const w = window as any;\r\n  if (typeof w.requestIdleCallback === 'function') {\r\n    const id = w.requestIdleCallback(cb, { timeout });\r\n    return () => w.cancelIdleCallback?.(id);\r\n  }\r\n  const t = window.setTimeout(cb, timeout);\r\n  return () => window.clearTimeout(t);\r\n}\r\n\r\nconst GameEnhancer: React.FC = () => {\r\n  const [sec, setSec] = useState<HTMLElement | null>(null);\r\n  const [onboardingEl, setOnboardingEl] = useState<HTMLElement | null>(null);\r\n  const [rootEl, setRootEl] = useState<HTMLElement | null>(null);\r\n  const [shouldMount, setShouldMount] = useState(false);\r\n  const [stageReady, setStageReady] = useState(false);\r\n\r\n  const firstHydrationUsedRef = useRef(false);\r\n  const firstVisibilityCallbackSkippedRef = useRef(false);\r\n\r\n  const wasVisibleRef = useRef(false);\r\n\r\n  // Force a clean re-mount of onboarding inner (resets lottie/visibility) after exit\r\n  const [onboardingReset, setOnboardingReset] = useState(0);\r\n  const reapplyOnboarding = useCallback(() => setOnboardingReset(v => v + 1), []);\r\n\r\n  const stableStartAtForThisMount = useMemo(\r\n  () => (firstHydrationUsedRef.current ? 0 : 30),\r\n  [onboardingReset] // ← only recompute when we intentionally remount onboarding\r\n  );\r\n\r\n  const handleInnerMount = useCallback(() => {\r\n  firstHydrationUsedRef.current = true;\r\n  }, []);\r\n  \r\n  useEffect(() => {\r\n    const container = document.getElementById('block-game') as HTMLElement | null;\r\n    if (!container) return;\r\n    setSec(container);\r\n\r\n    // SSR shell: <section … data-ssr-shell=\"block-game\">\r\n    const shell = container.querySelector('[data-ssr-shell=\"block-game\"]') as HTMLElement | null;\r\n    if (!shell) return;\r\n\r\n    // Host for onboarding UI: prefer existing .block-g-onboarding, else decorate the shell\r\n    let host = shell.querySelector('.block-g-onboarding') as HTMLElement | null;\r\n    if (!host) {\r\n      host = shell;\r\n      if (!host.classList.contains('block-g-onboarding')) {\r\n        host.classList.add('block-g-onboarding', 'tooltip-block-g');\r\n        host.setAttribute('aria-live', 'polite');\r\n        host.style.display ||= 'flex';\r\n        host.style.alignItems ||= 'center';\r\n      }\r\n    }\r\n\r\n    // Clean host children; we portal the inner UI into it\r\n    host.replaceChildren();\r\n    setOnboardingEl(host);\r\n\r\n    // Render the stage directly under the section (stacked after onboarding)\r\n    setRootEl(shell);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!sec) return;\r\n    const cancelIdle = scheduleIdle(() => setShouldMount(true), 2000);\r\n    const io = new IntersectionObserver(([entry]) => {\r\n      if (entry.isIntersecting) {\r\n        setShouldMount(true);\r\n        cancelIdle();            \r\n        io.disconnect();\r\n      }\r\n    }, { threshold: [0, 0.3] });\r\n    io.observe(sec);\r\n    return () => { io.disconnect(); cancelIdle(); };\r\n  }, [sec]);\r\n\r\n  useEffect(() => {\r\n    if (!sec) return;\r\n\r\n    const io = new IntersectionObserver(\r\n      ([entry]) => {\r\n        const nowVisible = !!entry.isIntersecting;\r\n\r\n        // Skip the first callback after hydration, just prime the baseline.\r\n        if (!firstVisibilityCallbackSkippedRef.current) {\r\n          firstVisibilityCallbackSkippedRef.current = true;\r\n          wasVisibleRef.current = nowVisible;\r\n          return;\r\n        }\r\n\r\n        const wasVisible = wasVisibleRef.current;\r\n        wasVisibleRef.current = nowVisible;\r\n\r\n        // Only remount when coming back into view later (and not in-game)\r\n        if (nowVisible && !wasVisible && !sec.classList.contains('ingame')) {\r\n          setOnboardingReset(v => v + 1);\r\n        }\r\n      },\r\n      { threshold: 0.01 }\r\n    );\r\n\r\n    io.observe(sec);\r\n    return () => io.disconnect();\r\n  }, [sec]);\r\n  \r\n  if (!sec || !onboardingEl || !rootEl || !shouldMount) return null;\r\n\r\n  return (\r\n    <>\r\n      {createPortal(\r\n        <OnboardingPortal\r\n          reset={onboardingReset}\r\n          startAtFrame={stableStartAtForThisMount} \r\n          onInnerMount={handleInnerMount}\r\n          label={stageReady ? 'Click Here to Play!' : 'Loading…'}  \r\n          ctaEnabled={stageReady}                                   \r\n        />,\r\n        onboardingEl\r\n      )}\r\n      {createPortal(\r\n        <GameStage\r\n          blockId=\"block-game\"\r\n          container={sec}\r\n          onboardingEl={onboardingEl}\r\n          reapplyOnboarding={reapplyOnboarding}\r\n          isStageReady={stageReady}                 \r\n          onStageReady={setStageReady}          \r\n        />,\r\n        rootEl\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\n  // let the portal thread the props to the inner\r\n  type OnboardingPortalProps = {\r\n    reset: number;\r\n    startAtFrame: number;\r\n    onInnerMount: () => void;\r\n    label: string;\r\n    ctaEnabled: boolean;\r\n  };\r\n\r\n  const OnboardingPortal: React.FC<OnboardingPortalProps> = ({\r\n    reset, startAtFrame, onInnerMount, label, ctaEnabled\r\n  }) => (\r\n    <BlockGOnboarding\r\n      key={reset}\r\n      startAtFrame={startAtFrame}\r\n      onMount={onInnerMount}\r\n      label={label}\r\n      ctaEnabled={ctaEnabled}\r\n    />\r\n  );\r\n\r\n  export default GameEnhancer;\r\n\r\n/* ---------- Stage (mirrors the working BlockGHost behavior) ---------- */\r\nconst GameStage: React.FC<{\r\n  blockId: string;                              // not used here; kept for signature compatibility\r\n  container: HTMLElement;\r\n  onboardingEl: HTMLElement;\r\n  reapplyOnboarding: () => void;\r\n  isStageReady: boolean;                        // NEW\r\n  onStageReady: (ready: boolean) => void;       // NEW\r\n}> = ({\r\n  blockId,\r\n  container,\r\n  onboardingEl,\r\n  reapplyOnboarding,\r\n  isStageReady,\r\n  onStageReady,\r\n}) => {\r\n  void blockId; // silence unused param if you keep passing it\r\n\r\n  const isRealMobile = useRealMobileViewport();\r\n\r\n  // lifecycle\r\n  const [started, setStarted] = useState(false);\r\n\r\n  // HUD + meta\r\n  const [coins, setCoins] = useState(0);\r\n  const [finalScore, setFinalScore] = useState<number | null>(null);\r\n\r\n  const remoteHighScore = useHighScoreSubscription();\r\n  const stableHigh = typeof remoteHighScore === 'number' ? remoteHighScore : 0;\r\n\r\n  // UI-only: mimic BlockGHost display logic\r\n  const displayHigh =\r\n    (finalScore == null ? coins : finalScore) > stableHigh\r\n      ? (finalScore == null ? coins : finalScore)\r\n      : stableHigh;\r\n\r\n  const beatingHighNow = finalScore == null && coins > stableHigh;\r\n\r\n  // overlays\r\n  const [countdownPhase, setCountdownPhase] = useState<null | 'lottie' | 'begin'>(null);\r\n  const [showBeginText, setShowBeginText] = useState(false);\r\n  const [showOverlayBg, setShowOverlayBg] = useState(false);\r\n  const [shouldRenderOverlayBg, setShouldRenderOverlayBg] = useState(false);\r\n  const lottieRef = useRef<HTMLDivElement | null>(null);\r\n\r\n  // canvas restart API from game-canvas\r\n  const restartApi = useRef<{ restart: () => void } | null>(null);\r\n\r\n  // Start — only when stage is ready\r\n  const onStart = useCallback(() => {\r\n    if (!isStageReady) return; // gate until canvas called onReady\r\n    void gameLoaders.game();\r\n    container.classList.add('ingame');\r\n    activateGameMode();\r\n\r\n    setStarted(true);\r\n    setCoins(0);\r\n    setFinalScore(null);\r\n    setCountdownPhase('lottie');\r\n\r\n    requestAnimationFrame(() => (container as HTMLElement)?.focus?.());\r\n\r\n    onboardingEl.style.transition = 'opacity 180ms ease';\r\n    onboardingEl.style.opacity = '0';\r\n    window.setTimeout(() => { onboardingEl.style.display = 'none'; }, 180);\r\n  }, [container, onboardingEl, isStageReady]);\r\n\r\n  /** Limit start to coin/text only, AND reflect readiness in interactivity */\r\n  useEffect(() => {\r\n    const CLICK_TARGETS = '.coin, .onboarding-text, [data-start-hit]';\r\n\r\n    const armTargets = () => {\r\n      onboardingEl.querySelectorAll(CLICK_TARGETS).forEach((el) => {\r\n        const node = el as HTMLElement;\r\n        node.style.pointerEvents = isStageReady ? 'auto' : 'none';\r\n        node.style.cursor = isStageReady ? 'pointer' : 'default';\r\n        if (!node.hasAttribute('role')) node.setAttribute('role', 'button');\r\n        if (node.tabIndex < 0) node.tabIndex = 0;\r\n      });\r\n      onboardingEl.setAttribute('aria-busy', String(!isStageReady));\r\n    };\r\n\r\n    armTargets();\r\n    const mo = new MutationObserver(armTargets);\r\n    mo.observe(onboardingEl, { childList: true, subtree: true });\r\n\r\n    const onClick = (ev: Event) => {\r\n      if (!isStageReady) return;\r\n      const t = ev.target as HTMLElement | null;\r\n      if (t && t.closest(CLICK_TARGETS)) onStart();\r\n    };\r\n    const onKeyDown = (ev: KeyboardEvent) => {\r\n      if (!isStageReady) return;\r\n      if (ev.key === 'Enter' || ev.key === ' ') {\r\n        const t = ev.target as HTMLElement | null;\r\n        if (t && t.closest(CLICK_TARGETS)) {\r\n          ev.preventDefault();\r\n          onStart();\r\n        }\r\n      }\r\n    };\r\n\r\n    onboardingEl.addEventListener('click', onClick as EventListener, { passive: true });\r\n    onboardingEl.addEventListener('keydown', onKeyDown as EventListener);\r\n\r\n    return () => {\r\n      mo.disconnect();\r\n      onboardingEl.removeEventListener('click', onClick as EventListener);\r\n      onboardingEl.removeEventListener('keydown', onKeyDown as EventListener);\r\n    };\r\n  }, [onboardingEl, onStart, isStageReady]);\r\n\r\n  // Lottie countdown\r\n  useEffect(() => {\r\n    if (countdownPhase !== 'lottie' || !lottieRef.current) return;\r\n    const anim = lottie.loadAnimation({\r\n      container: lottieRef.current,\r\n      renderer: 'svg',\r\n      loop: false,\r\n      autoplay: true,\r\n      animationData: isRealMobile ? mobileOnboarding : desktopOnboarding,\r\n    });\r\n    const onComplete = () => setCountdownPhase('begin');\r\n    anim.addEventListener('complete', onComplete);\r\n    return () => { anim.removeEventListener('complete', onComplete); anim.destroy(); };\r\n  }, [countdownPhase, isRealMobile]);\r\n\r\n  useEffect(() => {\r\n    if (countdownPhase === 'begin') {\r\n      setShowBeginText(true);\r\n      const t = setTimeout(() => { setShowBeginText(false); setCountdownPhase(null); }, 1000);\r\n      return () => clearTimeout(t);\r\n    }\r\n  }, [countdownPhase]);\r\n\r\n  useEffect(() => {\r\n    if (countdownPhase === 'lottie') {\r\n      setShowOverlayBg(true);\r\n      setShouldRenderOverlayBg(true);\r\n    } else if (countdownPhase === null) {\r\n      setShowOverlayBg(false);\r\n      const t = setTimeout(() => setShouldRenderOverlayBg(false), 400);\r\n      return () => clearTimeout(t);\r\n    }\r\n  }, [countdownPhase]);\r\n\r\n  // Canvas bridges\r\n  const handleReady = (api: { restart: () => void }) => {\r\n    restartApi.current = api;\r\n    onStageReady(true); // flip CTA to \"Click to Play!\"\r\n  };\r\n\r\n  // If the whole enhancer unmounts, reset readiness\r\n  useEffect(() => () => onStageReady(false), [onStageReady]);\r\n\r\n  // Restart\r\n  const handleRestart = () => {\r\n    container.classList.add('ingame');\r\n    setCountdownPhase(null);\r\n    setCoins(0);\r\n    setFinalScore(null);\r\n    restartApi.current?.restart();\r\n    requestAnimationFrame(() => (container as HTMLElement)?.focus?.());\r\n  };\r\n\r\n  // Exit → return to onboarding\r\n  const handleExit = () => {\r\n    setStarted(false);\r\n    setCountdownPhase(null);\r\n    setCoins(0);\r\n    setFinalScore(null);\r\n    deactivateGameMode();\r\n\r\n    container.classList.remove('ingame');\r\n\r\n    onboardingEl.style.display = '';\r\n    reapplyOnboarding(); // remount onboarding inner\r\n    requestAnimationFrame(() => { onboardingEl.style.opacity = '1'; });\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {/* Global input guards while playing */}\r\n      <GameInputGuards active={started} lockBodyScroll alsoBlockWheel alsoBlockTouch allowWhenTyping />\r\n\r\n      {started && (\r\n        <>\r\n          <ExitButton onExit={handleExit} />\r\n          <CoinCounter\r\n            coins={coins}\r\n            highScore={displayHigh}\r\n            newHighScore={beatingHighNow}\r\n          />\r\n\r\n          {shouldRenderOverlayBg && (\r\n            <div\r\n              className={`countdown-bg-overlay ${!showOverlayBg ? 'hide' : ''}`}\r\n              style={{ pointerEvents: 'none' }}\r\n            />\r\n          )}\r\n\r\n          {(countdownPhase === 'lottie' || countdownPhase === 'begin') && (\r\n            <div\r\n              ref={lottieRef}\r\n              id=\"lottie-onboarding\"\r\n              className=\"countdown-lottie\"\r\n              style={{ pointerEvents: 'none' }}\r\n            />\r\n          )}\r\n\r\n          <GameOverController\r\n            score={finalScore}\r\n            highScore={stableHigh}\r\n            onRestart={handleRestart}\r\n            onHide={() => setFinalScore(null)}\r\n          />\r\n        </>\r\n      )}\r\n\r\n      {/* Stage under section */}\r\n      <LazyViewMount\r\n        load={() => import('../../components/rock-escapade/game-canvas')}\r\n        fallback={null}\r\n        /* Mount/Unmount hysteresis */\r\n        enterThreshold={0.2}\r\n        exitThreshold={0.05}\r\n        unmountDelayMs={150}\r\n        /* Preload the chunk early so re-mounts are instant */\r\n        preloadOnIdle\r\n        preloadIdleTimeout={2000}\r\n        preloadOnFirstIO\r\n        /* IO config */\r\n        rootMargin=\"0px\"\r\n        placeholderMinHeight={360}\r\n        componentProps={{\r\n          onReady: handleReady,            // flips stageReady\r\n          onCoinsChange: (n: number) => setCoins(n),\r\n          onGameOver: (finalCoins: number) => setFinalScore(finalCoins),\r\n          highScore: stableHigh,\r\n          pauseWhenHidden: true,\r\n          demoMode: !started,\r\n          overlayActive: countdownPhase === 'lottie' || countdownPhase === 'begin',\r\n          allowSpawns: !started || (started && (countdownPhase === 'begin' || countdownPhase === null)),\r\n        }}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\n"],"names":["React","useEffect","useRef","lottie","onboardingAnimation","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","BlockGOnboardingInner","onClick","onMount","onUnmount","startAtFrame","loopFromFrame","debug","label","hostRef","animRef","phaseRef","introDoneRef","absEndRef","mountRef","unmountRef","current","log","a","console","el","destroy","anim","loadAnimation","container","renderer","loop","autoplay","animationData","rendererSettings","preserveAspectRatio","progressiveLoad","getAbsEnd","frames","Math","max","floor","getDuration","totalFrames","playIntroOnce","absEnd","s","min","goToAndStop","playSegments","startTailLoop","tailStart","removeEventListener","onCompleteIntro","onDOMLoaded","frame","currentFrame","onLoopComplete","addEventListener","children","ref","className","style","pointerEvents","useMemo","useState","useCallback","createPortal","BlockGOnboarding","ExitButton","CoinCounter","GameOverController","useRealMobileViewport","LazyViewMount","gameLoaders","useHighScoreSubscription","GameInputGuards","desktopOnboarding","mobileOnboarding","GAME_MODE_CLASS","activateGameMode","document","body","classList","add","deactivateGameMode","remove","scheduleIdle","cb","timeout","w","window","requestIdleCallback","id","cancelIdleCallback","t","setTimeout","clearTimeout","GameEnhancer","sec","setSec","onboardingEl","setOnboardingEl","rootEl","setRootEl","shouldMount","setShouldMount","stageReady","setStageReady","firstHydrationUsedRef","firstVisibilityCallbackSkippedRef","wasVisibleRef","onboardingReset","setOnboardingReset","reapplyOnboarding","v","stableStartAtForThisMount","handleInnerMount","getElementById","shell","querySelector","host","contains","setAttribute","display","alignItems","replaceChildren","cancelIdle","io","IntersectionObserver","entry","isIntersecting","disconnect","threshold","observe","nowVisible","wasVisible","OnboardingPortal","reset","onInnerMount","ctaEnabled","GameStage","blockId","isStageReady","onStageReady","isRealMobile","started","setStarted","coins","setCoins","finalScore","setFinalScore","remoteHighScore","stableHigh","displayHigh","beatingHighNow","countdownPhase","setCountdownPhase","showBeginText","setShowBeginText","showOverlayBg","setShowOverlayBg","shouldRenderOverlayBg","setShouldRenderOverlayBg","lottieRef","restartApi","onStart","game","requestAnimationFrame","focus","transition","opacity","CLICK_TARGETS","armTargets","querySelectorAll","forEach","node","cursor","hasAttribute","tabIndex","String","mo","MutationObserver","childList","subtree","ev","target","closest","onKeyDown","key","preventDefault","passive","onComplete","handleReady","api","handleRestart","restart","handleExit","active","lockBodyScroll","alsoBlockWheel","alsoBlockTouch","allowWhenTyping","onExit","highScore","newHighScore","score","onRestart","onHide","load","fallback","enterThreshold","exitThreshold","unmountDelayMs","preloadOnIdle","preloadIdleTimeout","preloadOnFirstIO","rootMargin","placeholderMinHeight","componentProps","onReady","onCoinsChange","n","onGameOver","finalCoins","pauseWhenHidden","demoMode","overlayActive","allowSpawns"],"sourceRoot":""}