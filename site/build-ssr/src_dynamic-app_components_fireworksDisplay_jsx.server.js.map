{"version":3,"file":"src_dynamic-app_components_fireworksDisplay_jsx.server.js","mappings":"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","sources":["webpack://personal-site/./src/dynamic-app/components/fireworksDisplay.jsx"],"sourcesContent":["// Firework Animation Code\r\nimport React, { useRef, useEffect, useState, useCallback } from 'react';\r\nimport q5 from 'q5';\r\nimport { useRealMobileViewport } from '../../utils/content-utility/real-mobile.ts';\r\n\r\nconst FireworksDisplay = ({ colorMapping = {}, items = [], lastKnownColor, onToggleFireworks }) => {\r\n  const canvasRef = useRef(null);\r\n  const [fireworksEnabled, setFireworksEnabled] = useState(true);\r\n  const fireworksRef = useRef([]);\r\n  const fireworksEnabledRef = useRef(true);\r\n\r\n  const isPageHiddenRef = useRef(false);\r\n  const hiddenStartTimeRef = useRef(0);\r\n  const hiddenDurationRef = useRef(0);\r\n\r\n  const isRealMobile = useRealMobileViewport();\r\n  const isRealMobileRef = useRef(isRealMobile);\r\n\r\n  useEffect(() => {\r\n    isRealMobileRef.current = isRealMobile;\r\n  }, [isRealMobile]);\r\n\r\n  // Documént visibility\r\n  useEffect(() => {\r\n    const handleVisibilityChange = () => {\r\n      if (document.visibilityState === 'hidden') {\r\n        isPageHiddenRef.current = true;\r\n        hiddenStartTimeRef.current = performance.now();\r\n      } else if (document.visibilityState === 'visible') {\r\n        isPageHiddenRef.current = false;\r\n        const now = performance.now();\r\n        hiddenDurationRef.current += now - hiddenStartTimeRef.current;\r\n      }\r\n    };\r\n\r\n    document.addEventListener('visibilitychange', handleVisibilityChange);\r\n    return () => {\r\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n    };\r\n  }, []);\r\n\r\n  // Function to adjust brightness of a hex color\r\n  function adjustBrightness(hex, multiplier) {\r\n    // Convert hex to RGB\r\n    let r = parseInt(hex.slice(1, 3), 16);\r\n    let g = parseInt(hex.slice(3, 5), 16);\r\n    let b = parseInt(hex.slice(5, 7), 16);\r\n\r\n    // Apply brightness multiplier\r\n    r = Math.min(255, Math.max(0, Math.floor(r * multiplier)));\r\n    g = Math.min(255, Math.max(0, Math.floor(g * multiplier)));\r\n    b = Math.min(255, Math.max(0, Math.floor(b * multiplier)));\r\n\r\n    // Convert back to hex and return\r\n    return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;\r\n  }\r\n\r\n    const p5InstanceRef = useRef(null); // Track single p5 instance\r\n    const latestItems = useRef(items);\r\n    const latestColorMapping = useRef(colorMapping);\r\n    const latestLastKnownColor = useRef(lastKnownColor);\r\n\r\n  useEffect(() => {\r\n    latestItems.current = items;\r\n    latestColorMapping.current = colorMapping;\r\n    latestLastKnownColor.current = lastKnownColor;\r\n    }, [items, colorMapping, lastKnownColor]);\r\n\r\n  useEffect(() => {\r\n    let destroyed = false;\r\n\r\n    if (!canvasRef.current || p5InstanceRef.current || destroyed) return;\r\n\r\n\r\n      const sketch = (p) => {\r\n        let fireworks = fireworksRef.current;\r\n        let lastFireworkTime = -8000;\r\n        let lastLaunchPosition = p.createVector(p.width / 2, p.height);\r\n        const minDistance = 1000;\r\n\r\n        class Particle {\r\n          constructor(x, y, c, firework, size, type, hasTrail = false) {\r\n            this.pos = p.createVector(x, y);\r\n            this.vel = firework\r\n              ? p.createVector(0, p.random(-10, -20)) // Firework launch velocity\r\n              : p.createVector(p.random(-1, 1), p.random(-1, 1)).mult(p.random(0, 18)); // Explosion velocity\r\n            this.acc = p.createVector(0, 0);\r\n          \r\n            // Adjust brightness based on firework type and size\r\n            this.col = this.adjustBrightness(\r\n              c,\r\n              size > 10\r\n                ? p.random(1.4, 2) // Larger particles\r\n                : size > 5\r\n                ? p.random(1.1, 1.3) // Mid-size particles\r\n                : p.random(0.7, 1.1) // Smaller particles\r\n            );\r\n          \r\n            this.firework = firework;\r\n            this.size = size;\r\n            this.type = type;\r\n            this.hasTrail = hasTrail;\r\n          \r\n            this.shapeType = p.random(['circle', 'square', 'triangle']); // Add random shape selection\r\n          \r\n            // Randomize lifespan based on size (larger particles live longer)\r\n            let minLifespan, maxLifespan;\r\n\r\n            if (p.windowWidth < 768) {\r\n              minLifespan = p.random(30, 60);\r\n              maxLifespan = p.random(40, 80);\r\n            } else if (p.windowWidth <= 1024) {\r\n              minLifespan = p.random(50, 80);\r\n              maxLifespan = p.random(70, 100);\r\n            } else {\r\n              minLifespan = p.random(50, 90);\r\n              maxLifespan = p.random(80, 140);\r\n            }\r\n\r\n            this.lifespan = p.map(size, 1, 12, minLifespan, maxLifespan);\r\n\r\n          \r\n            // Adjust trail length based on particle size\r\n            this.trailLength = size >= 4 && size <= 12 ? 8 : 1; // Longer trail for larger particles\r\n            this.trail = Array(this.trailLength).fill(p.createVector(x, y)); // Set trail array\r\n          \r\n            // Map trailLifespan to speed (higher speed -> higher alpha, lower speed -> fade out)\r\n            const initialSpeed = this.vel.mag();\r\n            this.trailLifespan = Array(this.trailLength).fill(p.map(initialSpeed, 0, 20, 0, 100)); // Dynamically set based on speed\r\n          \r\n            this.fadeFactor = p.map(size, 1, 15, 0.6, 0.5); // Smaller particles fade faster\r\n          \r\n            // Blinking properties (only for explosion particles)\r\n            this.blinkingSpeed = firework ? 0 : p.random(5, 30); // Blinking speed for explosion particles\r\n            this.blinkingAlpha = firework ? 255 : 255; // Default alpha value for explosion particles\r\n          }           \r\n        \r\n          // Adjust brightness of the color\r\n          adjustBrightness(baseColor, multiplier) {\r\n            const r = Math.min(255, Math.max(0, baseColor.levels[0] * multiplier));\r\n            const g = Math.min(255, Math.max(0, baseColor.levels[1] * multiplier));\r\n            const b = Math.min(255, Math.max(0, baseColor.levels[2] * multiplier));\r\n            return p.color(r, g, b);\r\n          }\r\n        \r\n          applyForce(force) {\r\n            this.acc.add(force);\r\n          }\r\n        \r\n          update() {\r\n            this.vel.add(this.acc);\r\n            this.pos.add(this.vel);\r\n            this.acc.mult(0);\r\n        \r\n            if (!this.firework) {\r\n              this.vel.mult(0.927); // Slow down over time\r\n              this.lifespan -= this.fadeFactor; // Decrease lifespan\r\n        \r\n              // Make sure lifespan does not go below 0\r\n              if (this.lifespan <= 0) {\r\n                this.lifespan = 0;\r\n              }\r\n      \r\n              // Trail\r\n              if (this.hasTrail) {\r\n                this.trail.pop(); // Remove the oldest trail point\r\n                this.trail.unshift(this.pos.copy()); // Add the newest trail point\r\n                for (let i = 0; i < this.trailLifespan.length; i++) {\r\n                  this.trailLifespan[i] -= this.fadeFactor; // Gradually fade trail points\r\n                  this.trailLifespan[i] = Math.max(0, this.trailLifespan[i]); // Clamp lifespan to 0\r\n                }\r\n              }\r\n        \r\n              // Apply gravity based on particle size\r\n              let gravityForce;\r\n              if (this.size >= 1 && this.size < 2) {\r\n                gravityForce = p.random(-0.151, -0.161); // Weaker gravity for size 1\r\n              } else if (this.size >= 2 && this.size < 3) {\r\n                gravityForce = p.random(-0.146, -0.156); // Gravity for size 2\r\n              } else if (this.size >= 3 && this.size < 4) {\r\n                gravityForce = p.random(-0.144, -0.145); // Gravity for size 3\r\n              } else if (this.size >= 4 && this.size < 5) {\r\n                gravityForce = p.random(-0.141, -0.143); // Gravity for size 4\r\n              } else if (this.size >= 5 && this.size < 6) {\r\n                gravityForce = p.random(-0.139, -0.14); // Gravity for size 5\r\n              } else if (this.size >= 6 && this.size < 7) {\r\n                gravityForce = p.random(-0.137, -0.138); // Gravity for size 6\r\n              } else if (this.size >= 7 && this.size < 8) {\r\n                gravityForce = p.random(-0.135, -0.136); // Gravity for size 7\r\n              } else if (this.size >= 8 && this.size < 9) {\r\n                gravityForce = p.random(-0.134, -0.136); // Gravity for size 8\r\n              } else if (this.size <= 9) {\r\n                gravityForce = p.random(-0.135, -0.137); // Stronger gravity for size 9\r\n              } else if (this.size >= 10 && this.size <= 12) {\r\n                gravityForce = p.random(-0.094, -0.137); // Stronger gravity for size 9\r\n              }\r\n\r\n              this.applyForce(p.createVector(0, gravityForce)); // Apply gravity\r\n            }\r\n        \r\n            // Update blinking alpha for explosion particles\r\n            if (!this.firework && this.type === 'BLINKING') {\r\n              this.blinkingAlpha = Math.abs(255 * Math.sin((p.millis() / 1000) * this.blinkingSpeed));\r\n            }\r\n          }\r\n        \r\n          show() {\r\n            let alpha = this.firework\r\n              ? p.map(this.lifespan, 0, 255, 0, 255) // Normal fading for firework particles\r\n              : this.type === 'BLINKING'\r\n              ? this.blinkingAlpha // Blinking for explosion particles\r\n              : p.map(this.lifespan, 0, 255, 0, 255); // Fading for explosion particles\r\n          \r\n            p.noStroke();\r\n          \r\n            // Shrinking logic for the particle\r\n            let shrinkSize = this.size;\r\n            if (!this.firework) {\r\n              // Lifespan timing: calculate elapsed time (255 lifespan = full life)\r\n              const elapsedTime = p.map(this.lifespan, 255, 0, 0, 5); // 5 seconds total lifespan\r\n              const shrinkFactor = elapsedTime <= 2\r\n                ? 1 // No shrinking for the first 2 seconds\r\n                : p.map(this.lifespan, 255, 0, 1, 0); // Start shrinking after 2 seconds\r\n          \r\n              // Exponential shrinking towards the end\r\n              shrinkSize = this.size * (1 - Math.pow(1 - shrinkFactor, 6)); \r\n            }\r\n          \r\n            const normalizedSize = Math.max(shrinkSize * 1.1, 1); // Clamp minimum size to 1\r\n          \r\n            // Calculate rotation angle based on velocity vector\r\n            const rotationAngle = p.atan2(this.vel.y, this.vel.x); // Angle in radians\r\n          \r\n            // Draw trails first\r\n            if (this.hasTrail) {\r\n              for (let i = 0; i < this.trail.length; i++) {\r\n                const trailAlpha = this.trailLifespan[i];\r\n                if (trailAlpha > 0) {\r\n                  // Use a fixed size for trail points\r\n                  const trailSize = this.firework ? this.size * 0.9 : this.size * 0.8;\r\n            \r\n                  p.strokeWeight(trailSize); // Fixed trail size\r\n                  p.stroke(\r\n                    this.col.levels[0],\r\n                    this.col.levels[1],\r\n                    this.col.levels[2],\r\n                    trailAlpha\r\n                  );\r\n                  p.point(this.trail[i].x, this.trail[i].y);\r\n                }\r\n              }\r\n            }\r\n          \r\n            // Draw the main particle shape\r\n            p.push();\r\n            p.translate(this.pos.x, this.pos.y); // Move to particle position\r\n            p.rotate(rotationAngle); // Rotate based on velocity direction\r\n          \r\n            // Apply speed-based rotation scaling (optional)\r\n            const rotationSpeed = this.vel.mag() * 0.01; // Scale speed to adjust rotation dynamics\r\n            p.rotate(p.frameCount * rotationSpeed);\r\n          \r\n            p.fill(this.col.levels[0], this.col.levels[1], this.col.levels[2], alpha);\r\n          \r\n            // Draw shape based on shapeType\r\n            if (this.shapeType === 'circle') {\r\n              p.ellipse(0, 0, normalizedSize, normalizedSize);\r\n            } else if (this.shapeType === 'square') {\r\n              const halfSize = normalizedSize / 2;\r\n              p.rect(-halfSize, -halfSize, normalizedSize, normalizedSize);\r\n            } else if (this.shapeType === 'triangle') {\r\n              const halfSize = normalizedSize / 2;\r\n              p.triangle(\r\n                0, -halfSize, // Top vertex\r\n                -halfSize, halfSize, // Bottom-left vertex\r\n                halfSize, halfSize // Bottom-right vertex\r\n              );\r\n            }\r\n          \r\n            p.pop(); // Reset transformations\r\n          }        \r\n                      \r\n          // Check if the particle is done (lifespan is 0)\r\n          isDone() {\r\n            return this.lifespan <= 0; // Particle is done when lifespan is depleted\r\n          }\r\n        }\r\n        \r\n        class Firework {\r\n          constructor(x, y, targetX, targetY, col, type) {\r\n            this.firework = new Particle(x, y, col, true, 4, type);\r\n            this.particles = [];\r\n            this.exploded = false;\r\n            this.targetX = targetX;\r\n        \r\n            // Adjust explosion location based on screen width\r\n            if (p.windowWidth < 768) {\r\n              // For screens smaller than 768px, make the explosion higher on the screen\r\n              this.targetX = p.random(p.width * 0.5, p.width * 0.9);  \r\n              this.targetY = p.random(p.height * 0.1, p.height * 0.3);  \r\n              } else if (p.windowWidth >= 768 && p.windowWidth <= 1024) {\r\n              // For screens between 768px and 1024px, make the explosion in the middle\r\n              this.targetX = p.random(p.width * 0.65, p.width * 0.9);  \r\n              this.targetY = p.random(p.height * 0.05, p.height * 0.3);  \r\n              } else {\r\n              // For screens larger than 1024px, make the explosion lower on the screen\r\n              this.targetX = p.random(p.width * 0.3, p.width * 0.7);  \r\n              this.targetY = p.random(p.height * 0.05, p.height * 0.4);  \r\n            }\r\n        \r\n            this.col = col;\r\n            this.type = type;\r\n            this.explosionStartTime = -1;\r\n\r\n            // Particle amount logic\r\n            let baseCount;\r\n          if (p.windowWidth < 768) {\r\n            baseCount = type === 'BLINKING'\r\n              ? p.random(150, 300)\r\n              : p.random(125, 250);\r\n          } else if (p.windowWidth <= 1024) {\r\n            baseCount = type === 'BLINKING'\r\n              ? p.random(275, 375)\r\n              : p.random(200, 300); // Fewer PROJECTILE particles on medium screens\r\n          } else {\r\n            baseCount = type === 'BLINKING'\r\n              ? p.random(375, 475)\r\n              : p.random(400, 500);\r\n            }\r\n            this.numParticles = Math.floor(baseCount);\r\n          }\r\n        \r\n          explode() {\r\n            // Capture the firework's initial velocity to influence explosion particles\r\n            let initialVel = this.firework.vel.copy(); // Copy firework's velocity to influence explosion\r\n            \r\n            //limit particle count for larger ones between 25 to 50\r\n            const largerParticleCount = this.type === 'PROJECTILE' ? Math.floor(p.random(25, 50)) : 0;\r\n\r\n            for (let i = 0; i < this.numParticles; i++) {\r\n              let size;\r\n          \r\n              // Assign size based on whether it's a larger particle or a regular one\r\n              if (this.type === 'PROJECTILE' && i < largerParticleCount) {\r\n                size = p.random(10, 12); // Extra large particles for PROJECTILE\r\n              } else {\r\n                size = this.type === 'BLINKING' ? p.random(1, 9) : p.random(1, 8); // Smaller particles\r\n              }\r\n          \r\n              let speed = this.type === 'BLINKING'\r\n              ? (() => {\r\n                  // Inline definition for BLINKING firework speed calculation\r\n                  let speed;\r\n                  if (size >= 1 && size < 2) {\r\n                    speed = p.random(0.5, 2.7);\r\n                  } else if (size >= 2 && size < 3) {\r\n                    speed = p.random(2.5, 4.7);\r\n                  } else if (size >= 3 && size < 4) {\r\n                    speed = p.random(4.5, 6.7);\r\n                  } else if (size >= 4 && size < 5) {\r\n                    speed = p.random(6.5, 8.7);\r\n                  } else if (size >= 5 && size < 6) {\r\n                    speed = p.random(8.5, 8.7);\r\n                  } else if (size >= 6 && size < 7) {\r\n                    speed = p.random(8.8, 9);\r\n                  } else if (size >= 7 && size < 8) {\r\n                    speed = p.random(9.1, 9.2);\r\n                  } else if (size >= 8 && size < 9) {\r\n                    speed = p.random(9.2, 9.3);\r\n                  } else {\r\n                    speed = p.random(9.4, 9.5);\r\n                  }\r\n                  return adjustForScreenWidth(speed);\r\n                })()\r\n              : (() => {\r\n                  // Inline definition for PROJECTILE firework speed calculation\r\n                  let speed;\r\n                  if (size >= 1 && size < 7) {\r\n                    speed = p.random(1, 9);\r\n                  } else if (size >= 7 && size < 9) {\r\n                    speed = p.random(8, 9);\r\n                  } else if (size >= 10 && size < 12) {\r\n                    speed = p.random(9, 9.2);\r\n                  } else {\r\n                    speed = p.random(1, 4);\r\n                  }\r\n                  return adjustForScreenWidth(speed);\r\n                })();\r\n            \r\n            // Function to adjust speed based on screen size\r\n            function adjustForScreenWidth(speed) {\r\n              let screenWidth = p.windowWidth;\r\n              let screenMultiplier = 1; // Default multiplier\r\n            \r\n              if (screenWidth < 768) {\r\n                screenMultiplier = p.random(1.8, 2.6);\r\n              } else if (screenWidth >= 768 && screenWidth <= 1024) {\r\n                screenMultiplier = p.random(1.6, 2.2);\r\n              } else if (screenWidth > 1024) {\r\n                screenMultiplier = p.random(1.2, 2.2);\r\n              } \r\n              return speed * screenMultiplier;\r\n            }\r\n          \r\n              let angle = p.random(p.TWO_PI);\r\n              let velocity = p.createVector(p.cos(angle), p.sin(angle)).mult(speed);\r\n              \r\n              // Apply a smaller influence from firework velocity if particle is in line with the projectile\r\n              let angleDiff = Math.abs(p.atan2(velocity.y, velocity.x) - p.atan2(initialVel.y, initialVel.x));\r\n              \r\n              // If angle difference is small (i.e., the particle is moving along the same vector as the firework's trajectory), apply less multiplier\r\n              let velocityMultiplier = angleDiff < p.HALF_PI / 4 ? p.random(0, 0.5) : p.random(0.5, 0.8);\r\n              velocity.add(initialVel.mult(velocityMultiplier)); // Small influence from projectile velocity\r\n          \r\n              let hasTrail = size > 6; // Larger particles have trails\r\n                  \r\n              let type = 'BLINKING';\r\n              let particle = new Particle(\r\n                this.firework.pos.x + p.random(-2, 6),\r\n                this.firework.pos.y + p.random(-2, 6),\r\n                this.col,\r\n                false,\r\n                size,\r\n                type,\r\n                hasTrail\r\n              );\r\n                  \r\n              particle.vel = velocity;\r\n              this.particles.push(particle);\r\n            }\r\n            this.exploded = true;\r\n            this.explosionStartTime = p.millis();\r\n          }\r\n          \r\n          update() {\r\n            if (!this.exploded) {\r\n              let direction = p.createVector(this.targetX - this.firework.pos.x, this.targetY - this.firework.pos.y);\r\n              direction.normalize();\r\n              let launchSpeed;\r\n                if (p.windowWidth < 768) {\r\n                  launchSpeed = p.random(6, 11);\r\n                } else if (p.windowWidth <= 1024) {\r\n                  launchSpeed = p.random(5, 9); // Moderate speed boost for medium screens\r\n                } else {\r\n                  launchSpeed = p.random(3, 8);\r\n                }\r\n\r\n              direction.mult(launchSpeed);\r\n              this.firework.vel = direction;\r\n              this.firework.update();\r\n              if (p.dist(this.firework.pos.x, this.firework.pos.y, this.targetX, this.targetY) < 10) {\r\n                this.explode();\r\n              }\r\n            }\r\n            for (let i = this.particles.length - 1; i >= 0; i--) {\r\n              let particle = this.particles[i];\r\n              particle.applyForce(p.createVector(0, 0.160));  // Apply gravity force\r\n              particle.update();\r\n              if (particle.isDone()) {\r\n                this.particles.splice(i, 1);\r\n              }\r\n            }\r\n          }\r\n\r\n          show() {\r\n            if (!this.exploded) {\r\n              this.firework.show();\r\n            }\r\n            for (let particle of this.particles) {\r\n              particle.show();\r\n            }\r\n          }\r\n        }\r\n\r\n        function addNewFirework(fireworkType) {\r\n\r\n          const startX = p.width / 2;\r\n          const startY = p.height;\r\n\r\n          const selectedAlt1 = latestItems.current?.[0]?.alt1 || '';\r\n          const colorArray = latestColorMapping.current[selectedAlt1] || [];\r\n\r\n          // Early exit if no colors are available\r\n          if (!colorArray.length) {\r\n            console.warn(`No colors available for alt1: '${selectedAlt1}'`);\r\n            return;\r\n          }\r\n\r\n          let topColorCount;\r\n          if (p.windowWidth >= 1025) {\r\n            topColorCount = 3;\r\n          } else if (p.windowWidth >= 768) {\r\n            topColorCount = 2;\r\n          } else {\r\n            topColorCount = 1;\r\n          }\r\n\r\n          // Safely extract just 0, 1, and 3 (skip index 2)\r\n          const usableColors = [\r\n            colorArray[0],\r\n            colorArray[1],\r\n            colorArray[3],\r\n          ].filter(Boolean); // filter out undefined if array is incomplete\r\n          if (usableColors.length === 0) return;\r\n\r\n          const randomHex = usableColors[Math.floor(p.random(usableColors.length))]; // Pick one color\r\n\r\n          const brightnessMultiplier = p.random(1, 1.4);\r\n          const adjustedHex = adjustBrightness(randomHex, brightnessMultiplier);\r\n          const fireworkColor = p.color(adjustedHex);\r\n\r\n          const targetX = p.width / 2 + p.random(-50, 50);\r\n          const targetY = fireworkType === 'BLINKING' ? p.height * 0.2 : p.height * 0.7;\r\n\r\n          lastLaunchPosition = p.createVector(targetX, targetY);\r\n          fireworks.push(new Firework(startX, startY, targetX, targetY, fireworkColor, fireworkType));\r\n        }\r\n\r\n        p.setup = () => {\r\n          p.createCanvas(p.windowWidth, p.windowHeight);\r\n          const firstFireworkType = Math.random() < 0.5 ? 'BLINKING' : 'PROJECTILE'; // Randomize first firework type\r\n          addNewFirework(firstFireworkType); // Launch the first firework\r\n          lastFireworkTime = p.millis(); // Reset lastFireworkTime after the first launch\r\n        };      \r\n\r\n        hiddenDurationRef.current = 0;\r\n        lastFireworkTime = 0;\r\n        \r\n        let fireworkToggle = true; // Starts with BLINKING\r\n        let nextFireworkDelay = p.random(3000, 7000); // Random delay between 2000ms and 5000ms\r\n\r\n        p.draw = () => {\r\n          if (isRealMobileRef.current) {\r\n            p.clear(); // transparent\r\n          } else {\r\n            p.background('#1e1e1f'); // fallback\r\n          }\r\n            \r\n          if (!fireworksEnabledRef.current) {\r\n            fireworksRef.current.length = 0;\r\n            return;\r\n          }\r\n\r\n          for (let firework of fireworks) {\r\n            firework.update();\r\n            firework.show();\r\n          }\r\n\r\n          const adjustedTime = p.millis() - hiddenDurationRef.current;\r\n\r\n          // Fix: fallback in case adjustedTime went backward or got corrupted\r\n          if (adjustedTime < lastFireworkTime) {\r\n            console.warn(\"Adjusted time went backward or stale. Forcing firework reset.\");\r\n            lastFireworkTime = adjustedTime - nextFireworkDelay - 1;\r\n          }\r\n\r\n          // Regular triggering condition\r\n          if (adjustedTime - lastFireworkTime > nextFireworkDelay) {\r\n            const fireworkType = fireworkToggle ? 'BLINKING' : 'PROJECTILE';\r\n            addNewFirework(fireworkType);\r\n            fireworkToggle = !fireworkToggle;\r\n            lastFireworkTime = adjustedTime;\r\n            nextFireworkDelay = p.random(2000, 8000);\r\n          }\r\n        };\r\n      };\r\n      \r\n    p5InstanceRef.current = new q5(sketch, canvasRef.current);\r\n\r\n    return () => {\r\n      destroyed = true;\r\n      if (p5InstanceRef.current) {\r\n        p5InstanceRef.current.remove();\r\n        p5InstanceRef.current = null;\r\n      }\r\n      fireworksRef.current = [];\r\n    };\r\n  }, []);\r\n\r\n  const toggleFireworks = useCallback((isEnabled) => {\r\n    setFireworksEnabled(isEnabled);\r\n    fireworksEnabledRef.current = isEnabled; // update live value for q5\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (onToggleFireworks) {\r\n      onToggleFireworks(toggleFireworks);\r\n    }\r\n  }, [onToggleFireworks, toggleFireworks]); // Ensure dependencies are stable  \r\n\r\n  return <div ref={canvasRef}></div>;\r\n};\r\n\r\nexport default FireworksDisplay;"],"names":["React","useRef","useEffect","useState","useCallback","q5","useRealMobileViewport","jsx","_jsx","FireworksDisplay","colorMapping","items","lastKnownColor","onToggleFireworks","canvasRef","fireworksEnabled","setFireworksEnabled","fireworksRef","fireworksEnabledRef","isPageHiddenRef","hiddenStartTimeRef","hiddenDurationRef","isRealMobile","isRealMobileRef","current","handleVisibilityChange","document","visibilityState","performance","now","addEventListener","removeEventListener","adjustBrightness","hex","multiplier","r","parseInt","slice","g","b","Math","min","max","floor","toString","padStart","p5InstanceRef","latestItems","latestColorMapping","latestLastKnownColor","destroyed","sketch","p","fireworks","lastFireworkTime","lastLaunchPosition","createVector","width","height","minDistance","Particle","constructor","x","y","c","firework","size","type","hasTrail","pos","vel","random","mult","acc","col","shapeType","minLifespan","maxLifespan","windowWidth","lifespan","map","trailLength","trail","Array","fill","initialSpeed","mag","trailLifespan","fadeFactor","blinkingSpeed","blinkingAlpha","baseColor","levels","color","applyForce","force","add","update","pop","unshift","copy","i","length","gravityForce","abs","sin","millis","show","alpha","noStroke","shrinkSize","elapsedTime","shrinkFactor","pow","normalizedSize","rotationAngle","atan2","trailAlpha","trailSize","strokeWeight","stroke","point","push","translate","rotate","rotationSpeed","frameCount","ellipse","halfSize","rect","triangle","isDone","Firework","targetX","targetY","particles","exploded","explosionStartTime","baseCount","numParticles","explode","initialVel","largerParticleCount","speed","adjustForScreenWidth","screenWidth","screenMultiplier","angle","TWO_PI","velocity","cos","angleDiff","velocityMultiplier","HALF_PI","particle","direction","normalize","launchSpeed","dist","splice","addNewFirework","fireworkType","startX","startY","selectedAlt1","alt1","colorArray","console","warn","topColorCount","usableColors","filter","Boolean","randomHex","brightnessMultiplier","adjustedHex","fireworkColor","setup","createCanvas","windowHeight","firstFireworkType","fireworkToggle","nextFireworkDelay","draw","clear","background","adjustedTime","remove","toggleFireworks","isEnabled","ref"],"sourceRoot":""}