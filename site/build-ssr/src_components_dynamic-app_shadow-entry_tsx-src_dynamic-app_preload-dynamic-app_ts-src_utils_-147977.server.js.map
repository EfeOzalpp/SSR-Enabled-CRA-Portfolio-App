{"version":3,"file":"src_components_dynamic-app_shadow-entry_tsx-src_dynamic-app_preload-dynamic-app_ts-src_utils_-147977.server.js","mappings":"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","sources":["webpack://personal-site/./src/components/dynamic-app/shadow-entry.tsx","webpack://personal-site/./src/dynamic-app/preload-dynamic-app.ts","webpack://personal-site/./src/utils/content-utility/real-mobile.ts"],"sourcesContent":["// src/components/dynamic-app/shadow-entry.tsx\r\nimport React, { useEffect, useState } from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport DynamicAppInbound from '../../dynamic-app/dynamic-app-shadow.jsx';\r\n\r\ntype Props = { blockId: string };\r\n\r\nconst ShadowEntry: React.FC<Props> = ({ blockId }) => {\r\n  const [target, setTarget] = useState<HTMLElement | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (typeof document === 'undefined') return;\r\n\r\n    const container = document.getElementById(blockId);\r\n    if (!container) return;\r\n\r\n    const tryFind = () => {\r\n      const overlay = container.querySelector<HTMLElement>('.screen-overlay') || null;\r\n      if (overlay) {\r\n        setTarget(overlay);\r\n        return true;\r\n      }\r\n      return false;\r\n    };\r\n\r\n    if (tryFind()) return;\r\n\r\n    const observer = new MutationObserver(() => {\r\n      if (tryFind()) observer.disconnect();\r\n    });\r\n    observer.observe(container, { childList: true, subtree: true });\r\n    return () => observer.disconnect();\r\n  }, [blockId]);\r\n\r\n  // Announce mount/unmount of the embedded scroll container to the outer controller\r\n  useEffect(() => {\r\n    if (!target) return;\r\n    const detail = { el: target, blockId };\r\n    window.dispatchEvent(new CustomEvent('embedded-app:mounted', { detail }));\r\n    return () => {\r\n      window.dispatchEvent(new CustomEvent('embedded-app:unmounted', { detail }));\r\n    };\r\n  }, [target, blockId]);\r\n\r\n  // Called by DynamicAppInbound (guarded there) on first paint\r\n  const handleReady = () => {\r\n    // hide any SSR/client spinner if present\r\n    const loader = document.getElementById('dynamic-overlay-loader');\r\n    if (loader) loader.style.display = 'none';\r\n    // notify listeners (e.g. enhancer / other logic)\r\n    window.dispatchEvent(new CustomEvent('dynamic-app:hydrated'));\r\n  };\r\n\r\n  if (!target) return null;\r\n\r\n  return ReactDOM.createPortal(\r\n    <DynamicAppInbound onFocusChange={() => {}} onReady={handleReady} />,\r\n    target\r\n  );\r\n};\r\n\r\nexport default ShadowEntry;\r\n","// src/dynamic-app/preload-dynamic-app.ts\r\nimport fetchSVGIcons from './lib/fetchSVGIcons';\r\nimport { fetchImages } from './lib/fetchUser';\r\n\r\nexport type Cache = { icons?: Record<string, string>; images?: any[] };\r\n\r\ntype IconLike = { title?: string; icon?: string; url?: string };\r\n\r\nlet cache: Cache = {};\r\nlet inFlight: Promise<Cache> | null = null;\r\n\r\nexport function getPreloadedDynamicApp(): Cache {\r\n  return cache;\r\n}\r\n\r\nexport function primeFromSSR(data?: Partial<Cache>) {\r\n  if (!data) return;\r\n  cache = { ...cache, ...data };\r\n}\r\n\r\nfunction toIconMap(list: IconLike[]): Record<string, string> {\r\n  return list.reduce((acc, it) => {\r\n    if (!it?.title) return acc;\r\n    const val = it.icon ?? it.url; // inline SVG takes precedence; else URL\r\n    if (typeof val === 'string' && val.length > 0) acc[it.title] = val;\r\n    return acc;\r\n  }, {} as Record<string, string>);\r\n}\r\n\r\n/** Wait for current preloading (if any), then return cache */\r\nexport async function whenDynamicPreloadReady(): Promise<Cache> {\r\n  if (cache.icons && cache.images) return cache;\r\n  if (inFlight) {\r\n    await inFlight;\r\n    return cache;\r\n  }\r\n  return cache;\r\n}\r\n\r\nexport async function ensureIconsPreload(): Promise<Record<string, string>> {\r\n  // If a full preloading is in-flight, wait for it instead of double-fetching\r\n  if (!cache.icons && inFlight) {\r\n    await inFlight;\r\n    return cache.icons || {};\r\n  }\r\n  if (cache.icons) return cache.icons;\r\n\r\n  let iconsRaw: unknown;\r\n  try {\r\n    iconsRaw = await fetchSVGIcons();\r\n  } catch {\r\n    iconsRaw = [];\r\n  }\r\n  const list = Array.isArray(iconsRaw) ? (iconsRaw as IconLike[]) : [];\r\n  const icons = toIconMap(list);\r\n  cache.icons = icons;\r\n  return icons;\r\n}\r\n\r\nexport async function ensureImagesPreload(): Promise<any[]> {\r\n  // If a full preloading is in-flight, wait for it instead of double-fetching\r\n  if (!cache.images && inFlight) {\r\n    await inFlight;\r\n    return cache.images || [];\r\n  }\r\n  if (cache.images) return cache.images;\r\n\r\n  let imagesRaw: unknown;\r\n  try {\r\n    imagesRaw = await fetchImages();\r\n  } catch {\r\n    imagesRaw = [];\r\n  }\r\n  const images = Array.isArray(imagesRaw) ? (imagesRaw as any[]) : [];\r\n  cache.images = images;\r\n  return images;\r\n}\r\n\r\n/** Convenience: ensure both icons + images (with in-flight dedupe) */\r\nexport async function ensureDynamicPreload(): Promise<Cache> {\r\n  if (cache.icons && cache.images) return cache;\r\n  if (inFlight) return inFlight;\r\n\r\n  inFlight = Promise.all([ensureIconsPreload(), ensureImagesPreload()])\r\n    .then(([icons, images]) => {\r\n      cache = { icons, images };\r\n      return cache;\r\n    })\r\n    .finally(() => {\r\n      inFlight = null;\r\n    });\r\n\r\n  return inFlight;\r\n}\r\n\r\n// Optional: hydrate from SSR\r\ndeclare global {\r\n  interface Window {\r\n    __DYNAMIC_PRELOAD__?: Cache;\r\n  }\r\n}\r\nif (typeof window !== 'undefined' && (window as any).__DYNAMIC_PRELOAD__) {\r\n  primeFromSSR((window as any).__DYNAMIC_PRELOAD__);\r\n}\r\n","// useRealMobileViewport.ts\r\nimport { useEffect, useState } from 'react';\r\n\r\nexport function useRealMobileViewport() {\r\n  const [isRealMobile, setIsRealMobile] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const checkMobile = () => {\r\n      const touch = navigator.maxTouchPoints > 0;\r\n      const coarse = window.matchMedia?.('(pointer: coarse)').matches ?? false;\r\n      const width = window.innerWidth;\r\n      const ua = navigator.userAgent || navigator.vendor || (window as any).opera;\r\n\r\n      // iOS detection (iPhone / iPad)\r\n      const isIOS = /iPad|iPhone|iPod/.test(ua) ||\r\n        (navigator.platform === 'MacIntel' && touch); // iPadOS pretends to be Mac\r\n\r\n      // Android detection\r\n      const isAndroid = /Android/.test(ua);\r\n\r\n      // Consider it real mobile if:\r\n      // - Touch exists, and viewport is small, or\r\n      // - Known mobile UA\r\n      const realMobile =\r\n        (touch && width <= 1024) ||\r\n        isIOS ||\r\n        isAndroid ||\r\n        coarse;\r\n\r\n      setIsRealMobile(realMobile);\r\n    };\r\n\r\n    checkMobile();\r\n    window.addEventListener('resize', checkMobile);\r\n    window.addEventListener('orientationchange', checkMobile);\r\n\r\n    return () => {\r\n      window.removeEventListener('resize', checkMobile);\r\n      window.removeEventListener('orientationchange', checkMobile);\r\n    };\r\n  }, []);\r\n\r\n  return isRealMobile;\r\n}\r\n"],"names":["React","useEffect","useState","ReactDOM","DynamicAppInbound","jsx","_jsx","ShadowEntry","blockId","target","setTarget","document","container","getElementById","tryFind","overlay","querySelector","observer","MutationObserver","disconnect","observe","childList","subtree","detail","el","window","dispatchEvent","CustomEvent","handleReady","loader","style","display","createPortal","onFocusChange","onReady","fetchSVGIcons","fetchImages","cache","inFlight","getPreloadedDynamicApp","primeFromSSR","data","toIconMap","list","reduce","acc","it","title","val","icon","url","length","whenDynamicPreloadReady","icons","images","ensureIconsPreload","iconsRaw","Array","isArray","ensureImagesPreload","imagesRaw","ensureDynamicPreload","Promise","all","then","finally","__DYNAMIC_PRELOAD__","useRealMobileViewport","isRealMobile","setIsRealMobile","checkMobile","touch","navigator","maxTouchPoints","coarse","matchMedia","matches","width","innerWidth","ua","userAgent","vendor","opera","isIOS","test","platform","isAndroid","realMobile","addEventListener","removeEventListener"],"sourceRoot":""}