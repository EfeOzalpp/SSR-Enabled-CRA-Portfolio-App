{"version":3,"file":"src_utils_media-providers_media-loader_tsx.server.js","mappings":"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","sources":["webpack://personal-site/./src/utils/media-providers/image-upgrade-manager.ts","webpack://personal-site/./src/utils/media-providers/media-loader.tsx","webpack://personal-site/./src/utils/media-providers/video-observer.tsx"],"sourcesContent":["// src/utils/image-upgrade-manager.ts\r\nlet totalImages = 0;\r\nlet loadedLowRes = 0;\r\nlet listeners: (() => void)[] = [];\r\nlet upgradeTimeout: ReturnType<typeof setTimeout> | null = null;\r\n\r\nexport const setUpgradeTimeout = (ms: number = 5000) => {\r\n  if (upgradeTimeout) return;\r\n  upgradeTimeout = setTimeout(() => {\r\n    listeners.forEach(fn => fn());\r\n    listeners = [];\r\n  }, ms);\r\n};\r\n\r\nexport const registerImage = () => {\r\n  totalImages++;\r\n  setUpgradeTimeout();\r\n};\r\n\r\nexport const notifyLowResLoaded = () => {\r\n  loadedLowRes++;\r\n  if (loadedLowRes >= totalImages) {\r\n    listeners.forEach(fn => fn());\r\n    listeners = [];\r\n  }\r\n};\r\n\r\nexport const onAllLowResLoaded = (callback: () => void) => {\r\n  listeners.push(callback);\r\n};\r\n","// src/utils/media-providers/media-loader.tsx\r\nimport { useRef, useState, useEffect } from 'react';\r\nimport { useVideoVisibility } from './video-observer';\r\nimport LoadingScreen from '../loading/loading';\r\nimport { SanityImageSource } from '@sanity/image-url/lib/types/types';\r\nimport {\r\n  getLowResImageUrl,\r\n  getMediumImageUrl,\r\n  getHighQualityImageUrl,\r\n  urlFor,\r\n} from './image-builder';\r\nimport {\r\n  registerImage,\r\n  notifyLowResLoaded,\r\n  onAllLowResLoaded,\r\n} from './image-upgrade-manager';\r\n\r\nfunction useNearViewport<T extends Element>(\r\n  ref: React.RefObject<T>,\r\n  { rootMargin = '900px 0px', threshold = 0, once = true } = {}\r\n) {\r\n  const [near, setNear] = useState(false);\r\n  useEffect(() => {\r\n    if (!ref.current || near) return;\r\n    const io = new IntersectionObserver(\r\n      (entries) => {\r\n        if (entries.some((e) => e.isIntersecting)) {\r\n          setNear(true);\r\n          if (once) io.disconnect();\r\n        }\r\n      },\r\n      { rootMargin, threshold }\r\n    );\r\n    io.observe(ref.current);\r\n    return () => io.disconnect();\r\n  }, [ref, near, rootMargin, threshold, once]);\r\n  return near;\r\n}\r\n\r\ntype VideoSetSrc = {\r\n  webmUrl?: string;\r\n  mp4Url?: string;\r\n  poster?: SanityImageSource | string;\r\n};\r\n\r\ntype MediaLoaderProps = {\r\n  type: 'image' | 'video';\r\n  src: string | SanityImageSource | VideoSetSrc | null | undefined;\r\n  alt?: string;\r\n  id?: string;\r\n  className?: string;\r\n  style?: React.CSSProperties;\r\n  objectPosition?: string;\r\n  loop?: boolean;\r\n  muted?: boolean;\r\n  playsInline?: boolean;\r\n  preload?: 'auto' | 'metadata' | 'none';\r\n  enableVisibilityControl?: boolean;\r\n  priority?: boolean;\r\n  controls?: boolean;\r\n};\r\n\r\nconst MediaLoader = ({\r\n  type,\r\n  src,\r\n  alt = '',\r\n  id,\r\n  className = '',\r\n  style = {},\r\n  objectPosition = 'center center',\r\n  loop = true,\r\n  muted = true,\r\n  playsInline = true,\r\n  preload = 'metadata',\r\n  enableVisibilityControl = true,\r\n  priority = false,\r\n  controls = false,\r\n}: MediaLoaderProps) => {\r\n  const isSSR = typeof window === 'undefined';\r\n\r\n  // Start as loaded in SSR to avoid fade-in on hydration\r\n  const [loaded, setLoaded] = useState(isSSR);\r\n  const [showMedium, setShowMedium] = useState(false);\r\n  const [showHigh, setShowHigh] = useState(false);\r\n\r\n  // Native poster control (no overlay)\r\n  const [posterRemoved, setPosterRemoved] = useState(false);\r\n\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const imgRef = useRef<HTMLImageElement>(null);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n\r\n  const isNear = useNearViewport(containerRef);\r\n  const shouldStart = priority || isNear;\r\n\r\n  // If already cached, skip fade-in\r\n  useEffect(() => {\r\n    if (type === 'image' && imgRef.current?.complete) setLoaded(true);\r\n    if (type === 'video' && videoRef.current?.readyState >= 2) setLoaded(true);\r\n  }, [type]);\r\n\r\n  // IMAGE progressive upgrade\r\n  useEffect(() => {\r\n    if (type !== 'image') return;\r\n    registerImage();\r\n\r\n    const t1 = setTimeout(() => setShowMedium(true), shouldStart ? 0 : 2000);\r\n    if (shouldStart) setShowMedium(true);\r\n\r\n    const off = () => setTimeout(() => setShowHigh(true), 300);\r\n    onAllLowResLoaded(off);\r\n    const t2 = setTimeout(() => setShowHigh(true), 5000);\r\n\r\n    return () => {\r\n      clearTimeout(t1);\r\n      clearTimeout(t2);\r\n    };\r\n  }, [type, shouldStart]);\r\n\r\n  const onMediaLoaded = () => {\r\n    setLoaded(true);\r\n    if (type === 'image') notifyLowResLoaded();\r\n    if (id) {\r\n      const event = new CustomEvent('mediaReady', { detail: { id } });\r\n      window.dispatchEvent(event);\r\n    }\r\n  };\r\n\r\n  // ----- Video source parsing + poster URL -----\r\n  const isVideoSetObj =\r\n    typeof src === 'object' &&\r\n    src !== null &&\r\n    !('asset' in (src as any)) &&\r\n    (('webmUrl' in (src as any)) || ('mp4Url' in (src as any)));\r\n\r\n  const vs = (isVideoSetObj ? (src as VideoSetSrc) : undefined);\r\n  const legacyVideoUrl = typeof src === 'string' ? src : undefined;\r\n\r\n  const posterUrl =\r\n    vs?.poster\r\n      ? (typeof vs.poster === 'string'\r\n          ? vs.poster\r\n          : urlFor(vs.poster).width(1200).quality(80).auto('format').url())\r\n      : undefined;\r\n\r\n  // ✅ Keep native poster visible until the first *painted* frame, then remove it.\r\n  useEffect(() => {\r\n    if (type !== 'video' || !videoRef.current) return;\r\n    const v = videoRef.current;\r\n\r\n    const hidePoster = () => {\r\n      setPosterRemoved(true);\r\n      v.removeAttribute('poster');\r\n    };\r\n\r\n    const onPlay = () => {\r\n      const anyV = v as any;\r\n      if (typeof anyV.requestVideoFrameCallback === 'function') {\r\n        anyV.requestVideoFrameCallback(() => hidePoster());\r\n      } else {\r\n        const onTime = () => {\r\n          if (v.currentTime > 0 && v.readyState >= 2) {\r\n            v.removeEventListener('timeupdate', onTime);\r\n            hidePoster();\r\n          }\r\n        };\r\n        v.addEventListener('timeupdate', onTime);\r\n        const timer = setTimeout(() => {\r\n          v.removeEventListener('timeupdate', onTime);\r\n          hidePoster();\r\n        }, 1200);\r\n        return () => clearTimeout(timer);\r\n      }\r\n    };\r\n\r\n    v.addEventListener('play', onPlay, { once: true });\r\n    return () => v.removeEventListener('play', onPlay);\r\n  }, [type]);\r\n\r\n  // VIDEO visibility/autoplay (your existing hook takes care of play/pause)\r\n  useVideoVisibility(\r\n    videoRef,\r\n    containerRef,\r\n    type === 'video' && enableVisibilityControl ? 0.35 : (undefined as unknown as number)\r\n  );\r\n\r\n  // ─────────────────────────────────────────────────────────────\r\n  // VIDEO RELIABILITY PATCHES\r\n  // - Kick load when near\r\n  // - Retry once, then promote preload to 'auto'\r\n  // - Decode nudge for iOS Safari after loadedmetadata\r\n  // - Early \"loaded\" on loadedmetadata to remove spinner sooner\r\n  // - Gentle play kick when data is ready (muted+inline)\r\n  // ─────────────────────────────────────────────────────────────\r\n  useEffect(() => {\r\n    if (type !== 'video' || !videoRef.current) return;\r\n    const v = videoRef.current;\r\n\r\n    let retryTimer: number | null = null;\r\n    let promoteTimer: number | null = null;\r\n\r\n    const clearTimers = () => {\r\n      if (retryTimer) { window.clearTimeout(retryTimer); retryTimer = null; }\r\n      if (promoteTimer) { window.clearTimeout(promoteTimer); promoteTimer = null; }\r\n    };\r\n\r\n    // If we’re near (or priority), ensure the browser actually fetches metadata\r\n    const kickLoad = () => {\r\n      try {\r\n        // set the DOM property; the attribute React renders can be different and that's OK\r\n        v.preload = preload ?? 'metadata';\r\n        if (v.preload !== 'none') v.load(); // important: actually trigger the fetch\r\n      } catch {}\r\n    };\r\n\r\n    const nudgeDecode = () => {\r\n      // iOS Safari sometimes stalls after metadata; a tiny seek wakes decode\r\n      try {\r\n        if (v.readyState < 2) return;\r\n        const t = v.currentTime;\r\n        v.currentTime = t > 0 ? t : 0.001;\r\n      } catch {}\r\n    };\r\n\r\n    const tryPlay = async () => {\r\n      if (!enableVisibilityControl) return;\r\n      try {\r\n        if (v.muted && v.playsInline && v.paused && v.readyState >= 2) {\r\n          await v.play().catch(() => {});\r\n        }\r\n      } catch {}\r\n    };\r\n\r\n    const onLoadedMeta = () => {\r\n      // spinner can go away on metadata (poster is still covering until first frame)\r\n      setLoaded(true);\r\n      nudgeDecode();\r\n    };\r\n\r\n    const onLoadedData = () => { setLoaded(true); void tryPlay(); };\r\n    const onCanPlay = () => { setLoaded(true); void tryPlay(); };\r\n\r\n    if (shouldStart) {\r\n      kickLoad();\r\n\r\n      // If nothing after ~2.5s, try load() once more\r\n      retryTimer = window.setTimeout(() => {\r\n        if (v.readyState < 2) kickLoad();\r\n      }, 2500);\r\n\r\n      // Still nothing after ~5s? Promote preload to 'auto'\r\n      promoteTimer = window.setTimeout(() => {\r\n        if (v.readyState < 2) {\r\n          try { v.preload = 'auto'; v.load(); } catch {}\r\n        }\r\n      }, 5000);\r\n    }\r\n\r\n    v.addEventListener('loadedmetadata', onLoadedMeta);\r\n    v.addEventListener('loadeddata', onLoadedData);\r\n    v.addEventListener('canplay', onCanPlay);\r\n\r\n    // Optional: diagnostics for flaky networks\r\n    const onError = (e: Event) => console.warn('Video error', e);\r\n    const onStalled = () => console.warn('Video stalled');\r\n    const onSuspend = () => {/* benign on many browsers */};\r\n    v.addEventListener('error', onError);\r\n    v.addEventListener('stalled', onStalled);\r\n    v.addEventListener('suspend', onSuspend);\r\n\r\n    return () => {\r\n      clearTimers();\r\n      v.removeEventListener('loadedmetadata', onLoadedMeta);\r\n      v.removeEventListener('loadeddata', onLoadedData);\r\n      v.removeEventListener('canplay', onCanPlay);\r\n      v.removeEventListener('error', onError);\r\n      v.removeEventListener('stalled', onStalled);\r\n      v.removeEventListener('suspend', onSuspend);\r\n    };\r\n  }, [\r\n    type,\r\n    shouldStart,\r\n    preload,\r\n    enableVisibilityControl,\r\n    // if any URL changes, re-run the loader watchdog\r\n    isVideoSetObj,\r\n    (vs && vs.webmUrl) || '',\r\n    (vs && vs.mp4Url) || '',\r\n    legacyVideoUrl || '',\r\n  ]);\r\n\r\n  const hasVideoSource = Boolean(vs?.webmUrl || vs?.mp4Url || legacyVideoUrl);\r\n  if (!src || (type === 'video' && !hasVideoSource)) return null;\r\n\r\n  // ====== IMAGE ======\r\n  if (type === 'image') {\r\n    const ultraLowSrc = typeof src === 'string' ? src : getLowResImageUrl(src);\r\n    const mediumSrc   = typeof src === 'string' ? src : getMediumImageUrl(src);\r\n    const highResSrc  = typeof src === 'string' ? src : getHighQualityImageUrl(src);\r\n\r\n    const resolvedSrc = showHigh ? highResSrc : showMedium ? mediumSrc : ultraLowSrc;\r\n    if (!resolvedSrc) return null;\r\n\r\n    return (\r\n      <div ref={containerRef} style={{ position: 'relative', width: '100%', height: '100%' }}>\r\n        {!loaded && (\r\n          <div className=\"absolute-inset\">\r\n            <LoadingScreen isFullScreen={false} />\r\n          </div>\r\n        )}\r\n        <img\r\n          ref={imgRef}\r\n          loading={priority ? 'eager' : undefined}\r\n          fetchPriority={showHigh || priority ? 'high' : showMedium ? 'auto' : 'low'}\r\n          id={id}\r\n          src={resolvedSrc || undefined}\r\n          alt={alt}\r\n          onLoad={onMediaLoaded}\r\n          onError={(e) => console.warn('Image failed', (e.target as HTMLImageElement).src)}\r\n          className={className}\r\n          draggable={false}\r\n          style={{\r\n            ...style,\r\n            objectFit: 'cover',\r\n            objectPosition,\r\n            opacity: loaded ? 1 : 0,\r\n            transition: isSSR ? 'none' : 'filter 0.5s ease, opacity 0.3s ease',\r\n          }}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // ====== VIDEO ======\r\n  const showSpinner = !loaded;\r\n\r\n  return (\r\n    <div ref={containerRef} style={{ position: 'relative', width: '100%', height: '100%' }}>\r\n      {showSpinner && (\r\n        <div className=\"absolute-inset\">\r\n          <LoadingScreen isFullScreen={false} />\r\n        </div>\r\n      )}\r\n\r\n      <video\r\n        id={id}\r\n        ref={videoRef}\r\n        // treat loadeddata & metadata as “ready enough” for UI\r\n        onLoadedData={onMediaLoaded}\r\n        onLoadedMetadata={() => setLoaded(true)}\r\n        onError={(e) => console.warn('Video failed', e)}\r\n        className={className}\r\n        style={{\r\n          ...style,\r\n          objectFit: 'cover',\r\n          objectPosition,\r\n          opacity: loaded ? 1 : 0,\r\n          transition: isSSR ? 'none' : 'opacity 0.3s ease',\r\n          pointerEvents: 'all',\r\n          zIndex: 1,\r\n        }}\r\n        loop={loop}\r\n        muted={muted}\r\n        playsInline={playsInline}\r\n        preload={preload ?? 'metadata'}\r\n        controls={controls}\r\n        // If you host poster/video on different origins and ever read pixels to <canvas>,\r\n        // uncomment next line and ensure CORS headers exist:\r\n        // crossOrigin=\"anonymous\"\r\n        poster={posterRemoved ? undefined : posterUrl}\r\n      >\r\n        {/* Order matters: prefer MP4 first for Safari reliability */}\r\n        {vs?.mp4Url  && <source src={vs.mp4Url  || undefined} type=\"video/mp4\"  />}\r\n        {vs?.webmUrl && <source src={vs.webmUrl || undefined} type=\"video/webm\" />}\r\n        {!vs?.webmUrl && !vs?.mp4Url && legacyVideoUrl && (\r\n          <source src={legacyVideoUrl || undefined} />\r\n        )}\r\n      </video>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MediaLoader;\r\n","// video-observer.tsx\r\nimport { useEffect } from 'react';\r\n\r\nexport const useVideoVisibility = (\r\n  videoRef: React.RefObject<HTMLVideoElement> | null,\r\n  containerRef: React.RefObject<HTMLElement> | null,\r\n  threshold: number = 0.4\r\n) => {\r\n  useEffect(() => {\r\n    if (!videoRef?.current || !containerRef?.current) return;\r\n\r\n    const t = typeof threshold === 'number' && threshold >= 0 && threshold <= 1 ? threshold : 0.4;\r\n\r\n    let observer: IntersectionObserver | undefined;\r\n\r\n    const video = videoRef.current!;\r\n    const container = containerRef.current!;\r\n\r\n    // IMPORTANT: load even when using <source> children\r\n    // (video.src is empty in that case; currentSrc is set after load())\r\n    video.load();\r\n    video.muted = true;\r\n\r\n    observer = new IntersectionObserver(\r\n      ([entry]) => {\r\n        if (entry.isIntersecting) {\r\n          video.play().catch(() => setTimeout(() => video.play().catch(() => {}), 500));\r\n        } else {\r\n          video.pause();\r\n        }\r\n      },\r\n      { threshold: t }\r\n    );\r\n\r\n    observer.observe(container);\r\n\r\n    // kick once if already in view\r\n    const rect = container.getBoundingClientRect();\r\n    const ratio = Math.min(Math.max((window.innerHeight - rect.top) / window.innerHeight, 0), 1);\r\n    if (ratio >= t) video.play().catch(() => {});\r\n\r\n    return () => observer?.disconnect();\r\n  }, [videoRef, containerRef, threshold]);\r\n};\r\n"],"names":["totalImages","loadedLowRes","listeners","upgradeTimeout","setUpgradeTimeout","ms","setTimeout","forEach","fn","registerImage","notifyLowResLoaded","onAllLowResLoaded","callback","push","useRef","useState","useEffect","useVideoVisibility","LoadingScreen","getLowResImageUrl","getMediumImageUrl","getHighQualityImageUrl","urlFor","jsx","_jsx","jsxs","_jsxs","useNearViewport","ref","rootMargin","threshold","once","near","setNear","current","io","IntersectionObserver","entries","some","e","isIntersecting","disconnect","observe","MediaLoader","type","src","alt","id","className","style","objectPosition","loop","muted","playsInline","preload","enableVisibilityControl","priority","controls","isSSR","window","loaded","setLoaded","showMedium","setShowMedium","showHigh","setShowHigh","posterRemoved","setPosterRemoved","videoRef","imgRef","containerRef","isNear","shouldStart","complete","readyState","t1","off","t2","clearTimeout","onMediaLoaded","event","CustomEvent","detail","dispatchEvent","isVideoSetObj","vs","undefined","legacyVideoUrl","posterUrl","poster","width","quality","auto","url","v","hidePoster","removeAttribute","onPlay","anyV","requestVideoFrameCallback","onTime","currentTime","removeEventListener","addEventListener","timer","retryTimer","promoteTimer","clearTimers","kickLoad","load","nudgeDecode","t","tryPlay","paused","play","catch","onLoadedMeta","onLoadedData","onCanPlay","onError","console","warn","onStalled","onSuspend","webmUrl","mp4Url","hasVideoSource","Boolean","ultraLowSrc","mediumSrc","highResSrc","resolvedSrc","position","height","children","isFullScreen","loading","fetchPriority","onLoad","target","draggable","objectFit","opacity","transition","showSpinner","onLoadedMetadata","pointerEvents","zIndex","observer","video","container","entry","pause","rect","getBoundingClientRect","ratio","Math","min","max","innerHeight","top"],"sourceRoot":""}