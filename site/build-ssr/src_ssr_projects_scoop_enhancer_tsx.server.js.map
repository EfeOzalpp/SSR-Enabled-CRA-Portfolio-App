{"version":3,"file":"src_ssr_projects_scoop_enhancer_tsx.server.js","mappings":"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","sources":["webpack://personal-site/./src/ssr/projects/scoop.enhancer.tsx"],"sourcesContent":["// src/ssr/projects/scoop.enhancer.tsx\r\nimport { useEffect, useState } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport SplitDragHandler from '../../utils/split-controller';\r\nimport { useTooltipInit } from '../../utils/tooltip/tooltipInit';\r\nimport { applySplitStyle } from '../logic/apply-split-style';\r\n\r\nexport default function ScoopEnhancer() {\r\n  const [host, setHost] = useState<HTMLElement | null>(null);\r\n  const [split, setSplit] = useState(() => (window.innerWidth < 768 ? 55 : 50));\r\n  const [isPortrait, setIsPortrait] = useState(window.innerHeight > window.innerWidth);\r\n\r\n  useTooltipInit();\r\n\r\n  useEffect(() => {\r\n    // Collect all cleanups here so we can add to it anywhere below\r\n    const cleanup: Array<() => void> = [];\r\n\r\n    // Remove SSR preset so JS can control layout without specificity fights\r\n    document.getElementById('scoop-ssr')?.classList.remove('ssr-initial-split');\r\n\r\n    // Upgrade images/videos from SSR medium-quality to high-quality (if provided)\r\n    const img1El = document.querySelector('#scoop-ssr #icecream-media-1') as HTMLImageElement | null;\r\n    const vid2El = document.querySelector('#scoop-ssr #icecream-media-2') as HTMLVideoElement | null;\r\n\r\n    const full1 = img1El?.dataset?.srcFull;\r\n    const full2 = vid2El?.dataset?.srcFull;\r\n\r\n    // Upgrade LEFT media (image)\r\n    if (img1El && full1 && img1El.src !== full1) {\r\n      img1El.src = full1;\r\n    }\r\n\r\n    // Upgrade RIGHT media (video)\r\n    if (vid2El) {\r\n      // If high-quality poster exists, upgrade it before load\r\n      if (full2 && vid2El.poster !== full2) {\r\n        vid2El.poster = full2;\r\n      }\r\n\r\n      // Wait for the FIRST painted frame before removing poster (no black flash)\r\n      const removePoster = () => {\r\n        vid2El.removeAttribute('poster');\r\n      };\r\n\r\n      const onPlay = () => {\r\n        const anyV = vid2El as any;\r\n        if (typeof anyV.requestVideoFrameCallback === 'function') {\r\n          anyV.requestVideoFrameCallback(() => removePoster());\r\n        } else {\r\n          const onTime = () => {\r\n            if (vid2El.currentTime > 0 && vid2El.readyState >= 2) {\r\n              vid2El.removeEventListener('timeupdate', onTime);\r\n              removePoster();\r\n            }\r\n          };\r\n          vid2El.addEventListener('timeupdate', onTime, { once: true });\r\n          cleanup.push(() => vid2El.removeEventListener('timeupdate', onTime));\r\n\r\n          // Safety backstop\r\n          const timer = setTimeout(() => {\r\n            vid2El.removeEventListener('timeupdate', onTime);\r\n            removePoster();\r\n          }, 1200);\r\n          cleanup.push(() => clearTimeout(timer));\r\n        }\r\n      };\r\n\r\n      vid2El.addEventListener('play', onPlay, { once: true });\r\n      cleanup.push(() => vid2El.removeEventListener('play', onPlay));\r\n\r\n      // Trigger fetch (eager or metadata is fine here)\r\n      if (vid2El.readyState === 0) {\r\n        vid2El.preload = 'auto';\r\n        try { vid2El.load(); } catch {}\r\n      } else {\r\n        vid2El.preload = 'auto';\r\n      }\r\n\r\n      // Try to play (muted/inline should allow autoplay)\r\n      vid2El.play().catch(() => { /* ignored; poster remains until user interacts */ });\r\n    }\r\n\r\n    // Set mount host\r\n    setHost(document.getElementById('scoop-enhancer-mount'));\r\n\r\n    // Initial apply\r\n    applySplitStyle(split, isPortrait, {\r\n      m1: 'scoop-media-1-container',\r\n      m2: 'scoop-media-2-container',\r\n    });\r\n\r\n    // Orientation listener\r\n    const onResize = () => {\r\n      const p = window.innerHeight > window.innerWidth;\r\n      setIsPortrait(p);\r\n      applySplitStyle(split, p, {\r\n        m1: 'scoop-media-1-container',\r\n        m2: 'scoop-media-2-container',\r\n      });\r\n    };\r\n    window.addEventListener('resize', onResize, { passive: true });\r\n    cleanup.push(() => window.removeEventListener('resize', onResize));\r\n\r\n    return () => {\r\n      for (const fn of cleanup) {\r\n        try { fn(); } catch {}\r\n      }\r\n    };\r\n  }, []); // run once\r\n\r\n  // Keep DOM in sync when split OR orientation changes\r\n  useEffect(() => {\r\n    applySplitStyle(split, isPortrait, {\r\n      m1: 'scoop-media-1-container',\r\n      m2: 'scoop-media-2-container',\r\n    });\r\n  }, [split, isPortrait]);\r\n\r\n  if (!host) return null;\r\n  return createPortal(\r\n    <SplitDragHandler\r\n      split={split}\r\n      setSplit={setSplit}\r\n      ids={{ m1: 'scoop-media-1-container', m2: 'scoop-media-2-container' }}\r\n    />,\r\n    host\r\n  );\r\n}\r\n"],"names":["useEffect","useState","createPortal","SplitDragHandler","useTooltipInit","applySplitStyle","jsx","_jsx","ScoopEnhancer","host","setHost","split","setSplit","window","innerWidth","isPortrait","setIsPortrait","innerHeight","cleanup","document","getElementById","classList","remove","img1El","querySelector","vid2El","full1","dataset","srcFull","full2","src","poster","removePoster","removeAttribute","onPlay","anyV","requestVideoFrameCallback","onTime","currentTime","readyState","removeEventListener","addEventListener","once","push","timer","setTimeout","clearTimeout","preload","load","play","catch","m1","m2","onResize","p","passive","fn","ids"],"sourceRoot":""}