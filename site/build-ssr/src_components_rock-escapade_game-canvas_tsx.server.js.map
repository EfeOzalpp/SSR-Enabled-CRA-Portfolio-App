{"version":3,"file":"src_components_rock-escapade_game-canvas_tsx.server.js","mappings":"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","sources":["webpack://personal-site/./src/components/rock-escapade/game-canvas.tsx"],"sourcesContent":["// src/components/rock-escapade/GameCanvas.tsx\r\nimport { useEffect, useRef } from 'react';\r\nimport { useRealMobileViewport } from '../../utils/content-utility/real-mobile';\r\n\r\ntype Props = {\r\n  onCoinsChange?: (coins: number) => void;\r\n  highScore?: number;\r\n  onGameOver?: (finalCoins: number, isNewHigh: boolean) => void;\r\n  onReady?: (api: { restart: () => void }) => void;\r\n  pauseWhenHidden?: boolean;\r\n  demoMode?: boolean;\r\n  overlayActive?: boolean;\r\n  allowSpawns?: boolean;\r\n};\r\n\r\nexport default function GameCanvas({\r\n  onCoinsChange,\r\n  highScore = 0,\r\n  onGameOver,\r\n  onReady,\r\n  pauseWhenHidden = true,\r\n  demoMode = false,\r\n  overlayActive = false,\r\n  allowSpawns = true,\r\n}: Props) {\r\n  const hostRef = useRef<HTMLDivElement>(null);\r\n  const q5Ref = useRef<any>(null);\r\n  const visibleRef = useRef(true);\r\n  const cleanupRef = useRef<(() => void) | null>(null);\r\n\r\n  // prop refs\r\n  const coinsChangeRef = useRef(onCoinsChange);\r\n  const gameOverRef = useRef(onGameOver);\r\n  const readyRef = useRef(onReady);\r\n  const highScoreRef = useRef(highScore);\r\n  const pauseHiddenRef = useRef(pauseWhenHidden);\r\n  const demoRef = useRef(!!demoMode);\r\n  const overlayRef = useRef(!!overlayActive);\r\n  const allowSpawnsRef = useRef(allowSpawns);\r\n\r\n  coinsChangeRef.current = onCoinsChange;\r\n  gameOverRef.current = onGameOver;\r\n  readyRef.current = onReady;\r\n  highScoreRef.current = highScore;\r\n  pauseHiddenRef.current = pauseWhenHidden;\r\n  demoRef.current = !!demoMode;\r\n  overlayRef.current = !!overlayActive;\r\n  allowSpawnsRef.current = !!allowSpawns;\r\n\r\n  const isRealMobile = useRealMobileViewport();\r\n\r\n  useEffect(() => {\r\n    let alive = true;\r\n    let io: IntersectionObserver | null = null;\r\n    let onResize: (() => void) | null = null;\r\n\r\n    import('q5').then((q5mod) => {\r\n      if (!alive) return;\r\n      const q5 = (q5mod as any).default ?? (q5mod as any);\r\n\r\n      const el = hostRef.current;\r\n      if (!el || !el.isConnected) return;\r\n\r\n      // clear any old instance/canvas\r\n      el.replaceChildren();\r\n      if (q5Ref.current?.remove) {\r\n        try { q5Ref.current.remove(); } catch {}\r\n        q5Ref.current = null;\r\n      }\r\n\r\n      const sketch = (p: any) => {\r\n        // ---------------- Local state ----------------\r\n        let verticalMode = false;\r\n        let rectangles: any[] = [];\r\n        let octagons: any[] = [];\r\n        let particles: any[] = [];\r\n        let projectiles: any[] = [];\r\n        let circle: any;\r\n        let lastSpawnTime = 0;\r\n        let lastOctagonSpawnTime = 0;\r\n        let rectangleSpawnRate = 2;\r\n        let coins = 0;\r\n        let gameOver = false;\r\n        let prevGameOver = false;\r\n        let lastDemoFlag = true;\r\n\r\n        let lastFiredTime = -Infinity;\r\n        const cooldownDuration = 1500;\r\n        const cooldownRadiusMax = 48;\r\n\r\n        // perf caps\r\n        const MAX_PARTICLES = isRealMobile ? 600 : 1200;\r\n        const MAX_PROJECTILES = 140;\r\n        const MAX_RECTANGLES = 220;\r\n\r\n        // ---------- Pointer gesture state ----------\r\n        // One drag at a time\r\n        let dragPointerId: number | null = null;\r\n        let lastTouch: { x: number; y: number } | null = null;\r\n\r\n        // Primary candidate before promotion to drag\r\n        let primaryCandidateId: number | null = null;\r\n        type TapInfo = { x0: number; y0: number; x: number; y: number; t0: number };\r\n        let primaryTapInfo: TapInfo | null = null;\r\n\r\n        // Secondary tap candidates (never drag)\r\n        const tapCandidates = new Map<number, TapInfo>();\r\n\r\n        // thresholds\r\n        const TAP_MS = 180;\r\n        const TAP_MOVE = 12;     // also used as drag promotion threshold\r\n        const DRAG_PROMOTE = TAP_MOVE;\r\n        const baseImpulse = isRealMobile ? 0.5 : 0.35;\r\n\r\n        let movingUp = false;\r\n        let movingDown = false;\r\n        let movingLeft = false;\r\n        let movingRight = false;\r\n\r\n        // cached colors\r\n        let GOLD_COLORS: any[] = [];\r\n\r\n        function canSpawn() {\r\n          return demoRef.current || allowSpawnsRef.current;\r\n        }\r\n\r\n        // ---------------- API ----------------\r\n        const restartGame = () => {\r\n          gameOver = false;\r\n          coins = 0;\r\n          coinsChangeRef.current?.(coins);\r\n          rectangles = [];\r\n          octagons = [];\r\n          particles = [];\r\n          projectiles = [];\r\n          circle = new Circle(p, 240, p.height / 2, 33);\r\n          (q5Ref.current as any).circle = circle;\r\n          lastOctagonSpawnTime = p.millis();\r\n        };\r\n        (p as any).restartGame = restartGame;\r\n\r\n        // ---------------- Setup ----------------\r\n        p.setup = () => {\r\n          const w = el.offsetWidth;\r\n          const h = el.offsetHeight;\r\n\r\n          if (isRealMobile && p.pixelDensity) p.pixelDensity(1);\r\n          p.frameRate?.(60);\r\n          p.createCanvas(w, h);\r\n\r\n          // keep the page from stealing gestures\r\n          (el as HTMLElement).style.touchAction = 'none';\r\n          (p as any).canvas.style.touchAction = 'none';\r\n          (el as HTMLElement).style.overscrollBehavior = 'none';\r\n          (el as HTMLElement).style.webkitUserSelect = 'none';\r\n          (el as HTMLElement).style.userSelect = 'none';\r\n\r\n          const canvas = (p as any).canvas as HTMLCanvasElement;\r\n\r\n          const getCanvasCoords = (e: PointerEvent) => {\r\n            const r = canvas.getBoundingClientRect();\r\n            const x = (e.clientX - r.left) * (p.width / r.width);\r\n            const y = (e.clientY - r.top) * (p.height / r.height);\r\n            return { x, y };\r\n          };\r\n\r\n          const promoteToDrag = (pointerId: number, x: number, y: number) => {\r\n            dragPointerId = pointerId;\r\n            lastTouch = { x, y };\r\n            try { canvas.setPointerCapture(pointerId); } catch {}\r\n          };\r\n\r\n          // ----- handlers -----\r\n          const onDown = (e: PointerEvent) => {\r\n            if (demoRef.current || overlayRef.current) return;\r\n            const { x, y } = getCanvasCoords(e);\r\n\r\n            if (dragPointerId === null && primaryCandidateId === null) {\r\n              // first finger becomes a tap candidate; may promote to drag on move\r\n              primaryCandidateId = e.pointerId;\r\n              primaryTapInfo = { x0: x, y0: y, x, y, t0: p.millis() };\r\n            } else {\r\n              // any other finger is a pure tap candidate (never drag)\r\n              tapCandidates.set(e.pointerId, { x0: x, y0: y, x, y, t0: p.millis() });\r\n            }\r\n            e.preventDefault();\r\n          };\r\n\r\n          const onMove = (e: PointerEvent) => {\r\n            if (demoRef.current || overlayRef.current) return;\r\n            const { x, y } = getCanvasCoords(e);\r\n\r\n            // Candidate → promote to drag when moved enough\r\n            if (primaryCandidateId === e.pointerId && dragPointerId === null) {\r\n              // update candidate pos\r\n              if (primaryTapInfo) { primaryTapInfo.x = x; primaryTapInfo.y = y; }\r\n              const moved = primaryTapInfo\r\n                ? Math.hypot(x - primaryTapInfo.x0, y - primaryTapInfo.y0)\r\n                : 0;\r\n              if (moved > DRAG_PROMOTE) {\r\n                promoteToDrag(e.pointerId, x, y);\r\n                // no longer a tap candidate\r\n                primaryCandidateId = null;\r\n                primaryTapInfo = null;\r\n              }\r\n              e.preventDefault();\r\n              return;\r\n            }\r\n\r\n            // Active drag: only this pointer moves the ship\r\n            if (e.pointerId === dragPointerId) {\r\n              if (!lastTouch || !circle) { lastTouch = { x, y }; e.preventDefault(); return; }\r\n              const dx = x - lastTouch.x;\r\n              const dy = y - lastTouch.y;\r\n              const dist = Math.hypot(dx, dy) || 1;\r\n              const speedFactor = Math.log2(dist + 1);\r\n              const force = baseImpulse * speedFactor;\r\n              circle.vx += (dx / dist) * force;\r\n              circle.vy += (dy / dist) * force;\r\n              lastTouch = { x, y };\r\n              e.preventDefault();\r\n              return;\r\n            }\r\n\r\n            // Secondary tap candidates: track movement for tap thresholding\r\n            const ti = tapCandidates.get(e.pointerId);\r\n            if (ti) { ti.x = x; ti.y = y; }\r\n            e.preventDefault();\r\n          };\r\n\r\n          const tryFire = () => {\r\n            const now = p.millis();\r\n            if (now - lastFiredTime >= cooldownDuration) {\r\n              lastFiredTime = now;\r\n              const vx = (circle.vx !== 0 || circle.vy !== 0) ? circle.vx : 5;\r\n              const vy = (circle.vy !== 0 || circle.vx !== 0) ? circle.vy : 0;\r\n              projectiles.push(new Projectile(p, circle.x, circle.y, vx, vy));\r\n              if (projectiles.length > MAX_PROJECTILES) {\r\n                projectiles.splice(0, projectiles.length - MAX_PROJECTILES);\r\n              }\r\n            }\r\n          };\r\n\r\n          const onUp = (e: PointerEvent) => {\r\n            if (demoRef.current || overlayRef.current) return;\r\n\r\n            // End drag only if the drag pointer lifted\r\n            if (e.pointerId === dragPointerId) {\r\n              try { canvas.releasePointerCapture(e.pointerId); } catch {}\r\n              dragPointerId = null;\r\n              lastTouch = null;\r\n              e.preventDefault();\r\n              return;\r\n            }\r\n\r\n            // Primary candidate ended without being promoted → evaluate as tap\r\n            if (primaryCandidateId === e.pointerId && dragPointerId === null) {\r\n              const ti = primaryTapInfo;\r\n              primaryCandidateId = null;\r\n              primaryTapInfo = null;\r\n              if (ti) {\r\n                const dt = p.millis() - ti.t0;\r\n                const moved = Math.hypot(ti.x - ti.x0, ti.y - ti.y0);\r\n                if (dt <= TAP_MS && moved <= TAP_MOVE) tryFire();\r\n              }\r\n              e.preventDefault();\r\n              return;\r\n            }\r\n\r\n            // Secondary tap candidate → evaluate as tap\r\n            const ti = tapCandidates.get(e.pointerId);\r\n            if (ti) {\r\n              tapCandidates.delete(e.pointerId);\r\n              const dt = p.millis() - ti.t0;\r\n              const moved = Math.hypot(ti.x - ti.x0, ti.y - ti.y0);\r\n              if (dt <= TAP_MS && moved <= TAP_MOVE) tryFire(); // does NOT affect drag\r\n              e.preventDefault();\r\n            }\r\n          };\r\n\r\n          const onCancel = (e: PointerEvent) => {\r\n            // Clean up states safely\r\n            if (e.pointerId === dragPointerId) {\r\n              dragPointerId = null;\r\n              lastTouch = null;\r\n            }\r\n            if (primaryCandidateId === e.pointerId) {\r\n              primaryCandidateId = null;\r\n              primaryTapInfo = null;\r\n            }\r\n            tapCandidates.delete(e.pointerId);\r\n          };\r\n\r\n          canvas.addEventListener('pointerdown', onDown, { passive: false });\r\n          canvas.addEventListener('pointermove', onMove, { passive: false });\r\n          canvas.addEventListener('pointerup', onUp, { passive: false });\r\n          canvas.addEventListener('pointercancel', onCancel as any, { passive: false });\r\n          canvas.addEventListener('lostpointercapture', (e: any) => {\r\n            if (e.pointerId === dragPointerId) {\r\n              dragPointerId = null;\r\n              lastTouch = null;\r\n            }\r\n          });\r\n\r\n          (p as any)._pointerCleanup = () => {\r\n            try {\r\n              canvas.removeEventListener('pointerdown', onDown as any);\r\n              canvas.removeEventListener('pointermove', onMove as any);\r\n              canvas.removeEventListener('pointerup', onUp as any);\r\n              canvas.removeEventListener('pointercancel', onCancel as any);\r\n            } catch {}\r\n          };\r\n\r\n          verticalMode = window.innerWidth <= 1024 && window.innerHeight > window.innerWidth;\r\n\r\n          GOLD_COLORS = [\r\n            p.color(255, 215, 0),\r\n            p.color(255, 223, 70),\r\n            p.color(255, 200, 0),\r\n            p.color(255, 170, 50),\r\n          ];\r\n\r\n          lastOctagonSpawnTime = p.millis();\r\n          circle = new Circle(p, 240, h / 2, 33);\r\n          (q5Ref.current as any).circle = circle;\r\n\r\n          readyRef.current?.({ restart: restartGame });\r\n        };\r\n\r\n        // ---------------- Draw loop ----------------\r\n        p.draw = () => {\r\n          const demo = demoRef.current;\r\n\r\n          // detect demo → live transition\r\n          if (!demo && lastDemoFlag) {\r\n            rectangles = [];\r\n            octagons = [];\r\n            particles = [];\r\n            projectiles = [];\r\n            coins = 0;\r\n            coinsChangeRef.current?.(0);\r\n\r\n            circle.x = 240;\r\n            circle.y = p.height / 2;\r\n            circle.vx = circle.vy = circle.ax = circle.ay = 0;\r\n\r\n            lastOctagonSpawnTime = p.millis();\r\n            lastSpawnTime       = p.millis();\r\n          }\r\n          lastDemoFlag = demo;\r\n\r\n          if (pauseHiddenRef.current && !visibleRef.current) {\r\n            p.background(28);\r\n            return;\r\n          }\r\n\r\n          const delta = p.deltaTime / 16.67;\r\n          p.background(28);\r\n\r\n          if (!demo && overlayRef.current) {\r\n            movingUp = movingDown = movingLeft = movingRight = false;\r\n            circle.stopHorizontal();\r\n            circle.stopVertical();\r\n          }\r\n\r\n          if (demo) {\r\n            autoEvade();\r\n          } else {\r\n            if (movingUp) circle.moveUp(); else if (movingDown) circle.moveDown(); else circle.stopVertical();\r\n            if (movingLeft) circle.moveLeft(); else if (movingRight) circle.moveRight(); else circle.stopHorizontal();\r\n          }\r\n\r\n          circle.update(delta);\r\n          circle.display();\r\n\r\n          spawnRectangles(p);\r\n          updateRectangles(p, delta);\r\n\r\n          spawnOctagons(p);\r\n          updateOctagons(p, delta);\r\n\r\n          if (!isRealMobile) p.blendMode(p.ADD);\r\n          for (let i = particles.length - 1; i >= 0; i--) {\r\n            const part = particles[i];\r\n            part.update(delta);\r\n            part.display();\r\n            if (part.isDead()) particles.splice(i, 1);\r\n          }\r\n          if (!isRealMobile) p.blendMode(p.BLEND);\r\n\r\n          for (let i = projectiles.length - 1; i >= 0; i--) {\r\n            const proj = projectiles[i];\r\n            proj.update(delta);\r\n            proj.display();\r\n            if (proj.isDead()) projectiles.splice(i, 1);\r\n          }\r\n\r\n          // live-mode only HUD & game-over\r\n          if (!demo) {\r\n            if (!prevGameOver && gameOver) {\r\n              const isNewHigh = coins > (highScoreRef.current ?? 0);\r\n              gameOverRef.current?.(coins, isNewHigh);\r\n            }\r\n            prevGameOver = gameOver;\r\n\r\n            if (gameOver) { p.background(28, 180); return; }\r\n            drawCooldownRing();\r\n          } else {\r\n            gameOver = false; // demo never ends\r\n          }\r\n        };\r\n\r\n        // --- Demo simple AI: evade rectangles, seek octagons\r\n        function autoEvade() {\r\n          let evadeX = 0, evadeY = 0, danger = 0;\r\n\r\n          for (const rect of rectangles) {\r\n            const cx = rect.x + rect.w / 2;\r\n            const cy = rect.y + rect.h / 2;\r\n            const dx = circle.x - cx;\r\n            const dy = circle.y - cy;\r\n            const distSq = dx * dx + dy * dy;\r\n            if (distSq < 20000) {\r\n              const dist = Math.sqrt(distSq) || 1;\r\n              const weight = 1 / (dist + 300);\r\n              const force = weight * 150;\r\n              evadeX += (dx / dist) * force;\r\n              evadeY += (dy / dist) * force;\r\n              danger += (1 / (dist + 1)) * 10;\r\n            }\r\n          }\r\n\r\n          let attractX = 0, attractY = 0;\r\n          if (octagons.length > 0 && danger < 50) {\r\n            const target = octagons.reduce((a, b) => {\r\n              const da = p.dist(circle.x, circle.y, a.x + a.size / 2, a.y + a.size / 2);\r\n              const db = p.dist(circle.x, circle.y, b.x + b.size / 2, b.y + b.size / 2);\r\n              return db < da ? b : a;\r\n            });\r\n            const dx = (target.x + target.size / 2) - circle.x;\r\n            const dy = (target.y + target.size / 2) - circle.y;\r\n            const d = Math.sqrt(dx * dx + dy * dy) || 1;\r\n            attractX = (dx / d) * 0.45;\r\n            attractY = (dy / d) * 0.45;\r\n          }\r\n\r\n          circle.ax = evadeX + attractX;\r\n          circle.ay = evadeY + attractY;\r\n\r\n          if (circle.ax === 0 && circle.ay === 0) {\r\n            const cx = p.width / 2 - circle.x;\r\n            const cy = p.height / 2 - circle.y;\r\n            const d = Math.sqrt(cx * cx + cy * cy) || 1;\r\n            circle.ax = (cx / d) * 0.1;\r\n            circle.ay = (cy / d) * 0.1;\r\n          }\r\n        }\r\n\r\n        function drawCooldownRing() {\r\n          const elapsed = p.millis() - lastFiredTime;\r\n          if (elapsed >= cooldownDuration) return;\r\n          const progress = 1 - (elapsed / cooldownDuration);\r\n          const radius = progress * cooldownRadiusMax;\r\n          p.noStroke();\r\n          p.fill(200, 150, 255, 100);\r\n          p.ellipse(circle.x, circle.y, radius * 2, radius * 2);\r\n        }\r\n\r\n        // ---------------- Spawners/Updaters ----------------\r\n        function spawnRectangles(p: any) {\r\n          if (!allowSpawnsRef.current) return;\r\n          if (!canSpawn()) return;\r\n          const inView = rectangles.filter((r) =>\r\n            verticalMode ? r.y + r.h > 0 && r.y < p.height : r.x + r.w > 0 && r.x < p.width\r\n          ).length;\r\n\r\n          let maxRectangles: number;\r\n          if (window.innerWidth >= 1025) {\r\n            maxRectangles = 50;\r\n            if (inView < 10) rectangleSpawnRate = 6;\r\n            else if (inView < 25) rectangleSpawnRate = 5;\r\n            else if (inView < 40) rectangleSpawnRate = 4;\r\n            else rectangleSpawnRate = 0;\r\n          } else if (window.innerWidth >= 768) {\r\n            maxRectangles = 60;\r\n            if (inView < 8) rectangleSpawnRate = 5;\r\n            else if (inView < 20) rectangleSpawnRate = 4;\r\n            else if (inView < 40) rectangleSpawnRate = 3;\r\n            else rectangleSpawnRate = 0;\r\n          } else {\r\n            maxRectangles = 25;\r\n            if (inView < 10) rectangleSpawnRate = 4;\r\n            else if (inView < 20) rectangleSpawnRate = 3;\r\n            else rectangleSpawnRate = 1;\r\n          }\r\n\r\n          if (rectangleSpawnRate > 0 && p.millis() - lastSpawnTime > 2000 / rectangleSpawnRate && inView < maxRectangles) {\r\n            rectangles.push(new Shape(p, true, false, verticalMode));\r\n            lastSpawnTime = p.millis();\r\n          }\r\n\r\n          if (rectangles.length > MAX_RECTANGLES) rectangles.splice(0, rectangles.length - MAX_RECTANGLES);\r\n\r\n          if (p.millis() % 5000 < 20) {\r\n            rectangles = rectangles.filter((r) => !isNaN(r.x) && !isNaN(r.y));\r\n          }\r\n        }\r\n\r\n        function updateRectangles(p: any, delta: number) {\r\n          for (let i = rectangles.length - 1; i >= 0; i--) {\r\n            const r = rectangles[i];\r\n            r.update(delta);\r\n            r.display();\r\n            if (!demoRef.current && circle.overlaps(r)) gameOver = true;\r\n\r\n            // projectile collision\r\n            for (let j = projectiles.length - 1; j >= 0; j--) {\r\n              const proj = projectiles[j];\r\n              const projSize = (proj.size ?? proj.radius * 2);\r\n              const projX = proj.x - (proj.size ? proj.size / 2 : proj.radius);\r\n              const projY = proj.y - (proj.size ? proj.size / 2 : proj.radius);\r\n              const projW = projSize;\r\n              const projH = projSize;\r\n\r\n              if (\r\n                projX + projW > r.x &&\r\n                projX < r.x + r.w &&\r\n                projY + projH > r.y &&\r\n                projY < r.y + r.h\r\n              ) {\r\n                if (proj instanceof RectangleProjectile) {\r\n                  if (p.random() < 0.05) {\r\n                    rectangles.splice(i, 1);\r\n                    projectiles.splice(j, 1);\r\n                    burstRectangles(p, r.x + r.w / 2, r.y + r.h / 2);\r\n                  } else {\r\n                    proj.vx *= -1;\r\n                    proj.vy *= -1;\r\n                    proj.x += proj.vx * delta * 2;\r\n                    proj.y += proj.vy * delta * 2;\r\n                  }\r\n                } else {\r\n                  rectangles.splice(i, 1);\r\n                  projectiles.splice(j, 1);\r\n                  burstRectangles(p, r.x + r.w / 2, r.y + r.h / 2);\r\n                }\r\n                break;\r\n              }\r\n            }\r\n\r\n            const off = verticalMode\r\n              ? r.y - r.h > p.height + 100 || r.y + r.h < -100\r\n              : r.x + r.w < -100 || r.x - r.w > p.width + 100;\r\n\r\n            if (off) {\r\n              rectangles.splice(i, 1);\r\n              continue;\r\n            }\r\n          }\r\n\r\n          for (let i = 0; i < rectangles.length; i++) {\r\n            const r1 = rectangles[i];\r\n            for (let j = i + 1; j < rectangles.length; j++) {\r\n              const r2 = rectangles[j];\r\n              if (r1.overlaps(r2)) r1.resolveCollision(r2);\r\n            }\r\n          }\r\n        }\r\n\r\n        function burstRectangles(p: any, cx: number, cy: number) {\r\n          for (let k = 0; k < 8; k++) {\r\n            const angle = (p.TWO_PI / 8) * k;\r\n            const speed = p.random(2, 4);\r\n            const vx = Math.cos(angle) * speed;\r\n            const vy = Math.sin(angle) * speed;\r\n            projectiles.push(new RectangleProjectile(p, cx, cy, vx, vy, '#c896ff'));\r\n          }\r\n          if (projectiles.length > MAX_PROJECTILES) projectiles.splice(0, projectiles.length - MAX_PROJECTILES);\r\n        }\r\n\r\n        function spawnOctagons(p: any) {\r\n          if (!allowSpawnsRef.current) return;\r\n          if (!canSpawn()) return;\r\n          if (p.millis() - lastOctagonSpawnTime > 2000) {\r\n            if (octagons.length === 0) octagons.push(new Shape(p, true, true, verticalMode));\r\n            lastOctagonSpawnTime = p.millis();\r\n          }\r\n        }\r\n\r\n        function updateOctagons(p: any, delta: number) {\r\n          const buffer = 150;\r\n\r\n          for (let i = octagons.length - 1; i >= 0; i--) {\r\n            const o = octagons[i];\r\n            o.update(delta);\r\n            o.display();\r\n\r\n            if (circle.overlaps(o)) {\r\n              if (!demoRef.current) {\r\n                coins += 20;\r\n                coinsChangeRef.current?.(coins);\r\n              }\r\n              for (let j = 0; j < 10; j++) {\r\n                particles.push(new Particle(p, o.x + o.size / 2, o.y + o.size / 2, 255, o.c, 0, 0, 5));\r\n              }\r\n              if (particles.length > MAX_PARTICLES) particles.splice(0, particles.length - MAX_PARTICLES);\r\n              octagons.splice(i, 1);\r\n              continue;\r\n            }\r\n\r\n            const speed = Math.abs(o.vx) + Math.abs(o.vy);\r\n            let numParticles: number;\r\n            if (speed < 1) numParticles = 0.05;\r\n            else if (speed < 3) numParticles = 0.1;\r\n            else if (speed < 6) numParticles = 0.2;\r\n            else numParticles = 0.3;\r\n\r\n            const whole = Math.floor(numParticles);\r\n            const frac = numParticles - whole;\r\n\r\n            for (let j = 0; j < whole; j++) particles.push(new Particle(p, o.x + o.size / 2, o.y + o.size / 2, 255, o.c));\r\n            if (p.random() < frac) particles.push(new Particle(p, o.x + o.size / 2, o.y + o.size / 2, 255, o.c));\r\n            if (particles.length > MAX_PARTICLES) particles.splice(0, particles.length - MAX_PARTICLES);\r\n\r\n            if (\r\n              o.x + o.size < -buffer ||\r\n              o.x - o.size > p.width + buffer ||\r\n              o.y + o.size < -buffer ||\r\n              o.y - o.size > p.height + buffer\r\n            ) {\r\n              octagons.splice(i, 1);\r\n            }\r\n          }\r\n        }\r\n\r\n        // ---------------- Keyboard ----------------\r\n        p.keyPressed = () => {\r\n          if (demoRef.current || overlayRef.current) return;\r\n          if (p.key === ' ' || p.key === 'Spacebar') {\r\n            const now = p.millis();\r\n            if (now - lastFiredTime >= cooldownDuration) {\r\n              lastFiredTime = now;\r\n              if (circle) {\r\n                const vx = (circle.vx !== 0 || circle.vy !== 0) ? circle.vx : 5;\r\n                const vy = (circle.vy !== 0 || circle.vx !== 0) ? circle.vy : 0;\r\n                projectiles.push(new Projectile(p, circle.x, circle.y, vx, vy));\r\n                if (projectiles.length > MAX_PROJECTILES) projectiles.splice(0, projectiles.length - MAX_PROJECTILES);\r\n              }\r\n            }\r\n          }\r\n          if (p.key === 'w' || p.keyCode === p.UP_ARROW)    movingUp = true;\r\n          if (p.key === 's' || p.keyCode === p.DOWN_ARROW)  movingDown = true;\r\n          if (p.key === 'a' || p.keyCode === p.LEFT_ARROW)  movingLeft = true;\r\n          if (p.key === 'd' || p.keyCode === p.RIGHT_ARROW) movingRight = true;\r\n        };\r\n\r\n        p.keyReleased = () => {\r\n          if (demoRef.current || overlayRef.current) return;\r\n          if (p.key === 'w' || p.keyCode === p.UP_ARROW)    movingUp = false;\r\n          if (p.key === 's' || p.keyCode === p.DOWN_ARROW)  movingDown = false;\r\n          if (p.key === 'a' || p.keyCode === p.LEFT_ARROW)  movingLeft = false;\r\n          if (p.key === 'd' || p.keyCode === p.RIGHT_ARROW) movingRight = false;\r\n        };\r\n\r\n        // ---------------- Classes ----------------\r\n        class Circle {\r\n          p:any;x:number;y:number;vx:number;vy:number;ax:number;ay:number;radius:number;c:any;trail:any[];\r\n          constructor(p:any,x:number,y:number,r:number){\r\n            this.p=p;this.x=x;this.y=y;this.vx=0;this.vy=0;this.ax=0;this.ay=0;this.radius=r;this.c=p.color(200,150,255);this.trail=[];\r\n          }\r\n          update(delta:number){\r\n            this.vx+=this.ax*delta;this.vy+=this.ay*delta;\r\n            this.vx*=Math.pow(0.92,delta);this.vy*=Math.pow(0.92,delta);\r\n            this.x+=this.vx*delta;this.y+=this.vy*delta;\r\n            if(this.y+this.radius<0)this.y=this.p.height+this.radius;else if(this.y-this.radius>this.p.height)this.y=-this.radius;\r\n            if(this.x+this.radius<0)this.x=this.p.width+this.radius;else if(this.x-this.radius>this.p.width)this.x=-this.radius;\r\n            this.trail.push(this.p.createVector(this.x,this.y));if(this.trail.length>8)this.trail.shift();\r\n            const lim=10;this.vx=this.p.constrain(this.vx,-lim,lim);this.vy=this.p.constrain(this.vy,-lim,lim);\r\n          }\r\n          display(){\r\n            for(let i=0;i<this.trail.length;i++){\r\n              const pos=this.trail[i];const a=this.p.map(i,0,this.trail.length-1,30,100);const r=this.p.map(i,0,this.trail.length-1,this.radius/2,this.radius);\r\n              this.p.fill(200,150,255,a);this.p.noStroke();this.p.ellipse(pos.x,pos.y,r,r);\r\n            }\r\n            this.p.fill(this.c);this.p.noStroke();this.p.ellipse(this.x,this.y,this.radius,this.radius);\r\n          }\r\n          moveUp(){this.ay=-0.5;}moveDown(){this.ay=0.5;}moveLeft(){this.ax=-0.5;}moveRight(){this.ax=0.5;}stopVertical(){this.ay=0;}stopHorizontal(){this.ax=0;}\r\n          overlaps(other:any){\r\n            if(other.isOctagon){const d=this.p.dist(this.x,this.y,other.x+other.size/2,other.y+other.size/2);return d<this.radius+other.size/2;}\r\n            const cx=this.p.constrain(this.x,other.x,other.x+other.w);const cy=this.p.constrain(this.y,other.y,other.y+other.h);\r\n            const d=this.p.dist(this.x,this.y,cx,cy);return d<this.radius*0.3;\r\n          }\r\n        }\r\n\r\n        class Shape {\r\n          p:any;isOctagon:boolean;verticalMode:boolean;x=0;y=0;vx=0;vy=0;w=0;h=0;size=0;c:any;rotation=0;rotationSpeed=0;\r\n          constructor(p:any,startOff:boolean,isOct:boolean,vertical:boolean){this.p=p;this.isOctagon=isOct;this.verticalMode=vertical;this.reset(startOff);}\r\n          reset(startOff:boolean){\r\n            if(this.verticalMode){\r\n              this.x=this.p.random(this.p.width);\r\n              if(this.isOctagon){\r\n                this.y=startOff?-this.p.random(30,60):this.p.random(this.p.height);this.vx=this.p.random(-1.2,1.2);\r\n                if(this.p.random()<0.1)this.vy=this.p.random(6,9);else if(this.p.random()<0.2)this.vy=this.p.random(0.5,1.5);else this.vy=this.p.random(2,5);\r\n                this.size=25;this.c=this.p.random(GOLD_COLORS);\r\n              } else {\r\n                this.y=startOff?-this.p.random(60,120):this.p.random(this.p.height);this.vx=this.p.random(-0.5,0.5);this.vy=this.p.random(1,3);\r\n                this.w=this.p.random(28,70);this.h=this.p.random(28,70);this.c=this.p.color(235,235,255);\r\n              }\r\n            } else {\r\n              this.x=startOff?this.p.width+this.p.random(10,40):this.p.random(this.p.width);this.y=this.p.random(this.p.height);\r\n              if(this.isOctagon){\r\n                let baseX=this.p.random(-2.5,-0.5);if(window.innerWidth>=1025&&window.innerWidth>window.innerHeight)baseX*=4.5;\r\n                if(this.p.random()<0.1)baseX*=2;else if(this.p.random()<0.2)baseX*=0.5;this.vx=baseX;this.vy=this.p.random(-0.3,0.3);this.size=25;\r\n                this.c=this.p.random(GOLD_COLORS);\r\n              } else {\r\n                this.vx=this.p.random(-3,-1);this.vy=this.p.random(-0.5,0.5);\r\n                if(window.innerWidth>=1025&&window.innerWidth>window.innerHeight){this.w=this.p.random(33,105);this.h=this.p.random(33,105);}\r\n                else{this.w=this.p.random(30,75);this.h=this.p.random(30,75);}this.c=this.p.color(235,235,255);\r\n              }\r\n            }\r\n            this.rotation=0;this.rotationSpeed=this.p.random(-1,1);\r\n          }\r\n          update(delta:number){this.x+=this.vx*delta;this.y+=this.vy*delta;this.rotation+=this.rotationSpeed*delta;}\r\n          display(){\r\n            this.p.push();\r\n            this.p.translate(this.x+(this.isOctagon?this.size/2:this.w/2),this.y+(this.isOctagon?this.size/2:this.h/2));\r\n            this.p.rotate(this.p.radians(this.rotation));this.p.fill(this.c);this.p.noStroke();\r\n            if(this.isOctagon)this.drawOctagon(0,0,this.size);else{this.p.rectMode(this.p.CENTER);this.p.rect(0,0,this.w,this.h);}\r\n            this.p.pop();\r\n          }\r\n          drawOctagon(x:number,y:number,size:number){\r\n            const step=this.p.TWO_PI/8;this.p.beginShape();\r\n            for(let i=0;i<8;i++){const ang=i*step;const px=x+this.p.cos(ang)*size/2;const py=y+this.p.sin(ang)*size/2;this.p.vertex(px,py);}\r\n            this.p.endShape(this.p.CLOSE);\r\n          }\r\n          overlaps(o:any){\r\n            const w1=this.isOctagon?this.size:this.w;const h1=this.isOctagon?this.size:this.h;const w2=o.isOctagon?o.size:o.w;const h2=o.isOctagon?o.size:o.h;\r\n            return !(this.x+w1<o.x||this.x>o.x+w2||this.y+h1<o.y||this.y>o.y+h2);\r\n          }\r\n          resolveCollision(other:any){\r\n            const w1=this.isOctagon?this.size:this.w;const h1=this.isOctagon?this.size:this.h;const w2=other.isOctagon?other.size:other.w;const h2=other.isOctagon?other.size:other.h;\r\n            const overlapX=Math.min(this.x+w1,other.x+w2)-Math.max(this.x,other.x);const overlapY=Math.min(this.y+h1,other.y+h2)-Math.max(this.y,other.y);\r\n            if(overlapX<overlapY){\r\n              if(this.x<other.x){this.x-=overlapX/2;other.x+=overlapX/2;}else{this.x+=overlapX/2;other.x-=overlapX/2;}this.vx*=-1;other.vx*=-1;\r\n            } else {\r\n              if(this.y<other.y){this.y-=overlapY/2;other.y+=overlapY/2;}else{this.y+=overlapY/2;other.y-=overlapY/2;}this.vy*=-1;other.vy*=-1;\r\n            }\r\n          }\r\n        }\r\n\r\n        class Particle {\r\n          p:any;x:number;y:number;vx:number;vy:number;lifespan:number;c:any;\r\n          constructor(p:any,x:number,y:number,lifespan=255,c=p.color(255,215,0),srcVx=0,srcVy=0,mul:number|null=null){\r\n            this.p=p;this.x=x;this.y=y;this.lifespan=lifespan;this.c=c;\r\n            const srcSpeed=Math.sqrt(srcVx*srcVx+srcVy*srcVy);let speed=p.map(srcSpeed,0,5,1,3);speed=p.constrain(speed,1.2,3.5);if(mul!=null)speed*=mul;\r\n            const ang=p.random(0,p.TWO_PI);this.vx=Math.cos(ang)*speed+srcVx*0.1;this.vy=Math.sin(ang)*speed+srcVy*0.1;\r\n          }\r\n          update(delta:number){this.x+=this.vx*delta;this.y+=this.vy*delta;this.lifespan-=1*delta;}\r\n          display(){this.p.noStroke();this.p.fill(this.c.levels[0],this.c.levels[1],this.c.levels[2],this.lifespan);this.p.ellipse(this.x,this.y,4,4);}\r\n          isDead(){return this.lifespan<=0;}\r\n        }\r\n\r\n        class Projectile {\r\n          p:any;x:number;y:number;vx:number;vy:number;radius:number;lifespan:number;trail:{x:number;y:number;alpha:number}[];color:any;\r\n          minSpeed=0.6;maxSpeed=12;speed=this.minSpeed;targetSpeed=8;acceleration=3;\r\n          constructor(p:any,x:number,y:number,vx:number,vy:number){\r\n            this.p=p;this.x=x;this.y=y;const mag=Math.sqrt(vx*vx+vy*vy)||1;const dx=vx/mag;const dy=vy/mag;this.vx=dx*this.speed;this.vy=dy*this.speed;this.radius=6;this.lifespan=500;this.trail=[];this.color=p.color(200,150,255);\r\n          }\r\n          update(delta:number){\r\n            this.speed+=(this.targetSpeed-this.speed)*this.acceleration*delta;\r\n            if(this.speed<this.minSpeed)this.speed=this.minSpeed;if(this.speed>this.maxSpeed)this.speed=this.maxSpeed;\r\n            const mag=Math.sqrt(this.vx*this.vx+this.vy*this.vy)||1;const dx=this.vx/mag;const dy=this.vy/mag;this.vx=dx*this.speed;this.vy=dy*this.speed;\r\n            this.x+=this.vx*delta;this.y+=this.vy*delta;this.lifespan-=1*delta;this.trail.push({x:this.x,y:this.y,alpha:160});if(this.trail.length>20)this.trail.shift();\r\n            for(let i=0;i<this.trail.length;i++)this.trail[i].alpha*=0.8;\r\n          }\r\n          display(){\r\n            for(let i=0;i<this.trail.length;i++){const t=this.trail[i];this.p.fill(200,150,255,t.alpha);this.p.noStroke();this.p.ellipse(t.x,t.y,this.radius*2,this.radius*2);}\r\n            this.p.fill(this.color);this.p.noStroke();this.p.ellipse(this.x,this.y,this.radius*2,this.radius*2);\r\n          }\r\n          isDead(){return this.lifespan<=0||this.x<0||this.x>this.p.width||this.y<0||this.y>this.p.height;}\r\n        }\r\n\r\n        class RectangleProjectile {\r\n          p:any;x:number;y:number;vx:number;vy:number;size:number;lifespan:number;maxLifespan:number;color:any;rotation:number;rotationSpeed:number;\r\n          constructor(p:any,x:number,y:number,vx:number,vy:number,color:string){\r\n            this.p=p;this.x=x;this.y=y;this.size=p.random(8,20);const factor=this.p.map(this.size,8,20,1,2);this.vx=vx*factor;this.vy=vy*factor;\r\n            this.lifespan=80;this.maxLifespan=this.lifespan;this.color=p.color(color);this.rotation=p.random(360);this.rotationSpeed=p.random(-20,20);\r\n          }\r\n          update(delta:number){this.x+=this.vx*delta;this.y+=this.vy*delta;this.lifespan-=1*delta;this.rotation+=this.rotationSpeed*delta;}\r\n          display(){\r\n            this.p.push();this.p.translate(this.x,this.y);this.p.rotate(this.p.radians(this.rotation));\r\n            const a=this.p.map(this.lifespan,0,this.maxLifespan,0,255);this.p.fill(this.color.levels[0],this.color.levels[1],this.color.levels[2],a);\r\n            this.p.noStroke();this.p.rectMode(this.p.CENTER);this.p.rect(0,0,this.size,this.size);this.p.pop();\r\n          }\r\n          isDead(){return this.lifespan<=0||this.x<-50||this.x>this.p.width+50||this.y<-50||this.y>this.p.height+50;}\r\n        }\r\n      }; // end sketch\r\n\r\n      // ----- mount / resize / cleanup -----\r\n      requestAnimationFrame(() => {\r\n        if (!alive || !el.isConnected) return;\r\n\r\n        if (q5Ref.current) {\r\n          try { q5Ref.current.remove?.(); } catch {}\r\n          q5Ref.current = null;\r\n        }\r\n        let instance: any;\r\n        try { instance = new q5(sketch, el); }\r\n        catch (err) { console.error('[GameCanvas] q5 init error', err); return; }\r\n        q5Ref.current = instance;\r\n\r\n        if (pauseHiddenRef.current && 'IntersectionObserver' in window) {\r\n          io = new IntersectionObserver(([entry]) => {\r\n            visibleRef.current = entry.isIntersecting;\r\n            try {\r\n              if (entry.isIntersecting) q5Ref.current?.loop?.();\r\n              else q5Ref.current?.noLoop?.();\r\n            } catch {}\r\n          }, { threshold: 0.01 });\r\n          io.observe(el);\r\n        }\r\n\r\n        let ro: ResizeObserver | null = null;\r\n        const vv: VisualViewport | undefined = (window as any).visualViewport;\r\n        let lastW = 0, lastH = 0;\r\n\r\n        const resizeToHost = () => {\r\n          const host = hostRef.current;\r\n          const inst = q5Ref.current;\r\n          if (!host || !host.isConnected || !inst?.resizeCanvas) return;\r\n          const w = Math.max(1, Math.round(host.offsetWidth));\r\n          const h = Math.max(1, Math.round(host.offsetHeight));\r\n          if (w === lastW && h === lastH) return;\r\n          lastW = w; lastH = h;\r\n          try { inst.resizeCanvas(w, h); } catch (e) { console.warn('[GameCanvas] resize skipped', e); }\r\n        };\r\n\r\n        onResize = () => requestAnimationFrame(resizeToHost);\r\n        window.addEventListener('resize', onResize);\r\n\r\n        if ('ResizeObserver' in window) {\r\n          ro = new ResizeObserver(() => requestAnimationFrame(resizeToHost));\r\n          ro.observe(el);\r\n        }\r\n\r\n        window.addEventListener('orientationchange', onResize);\r\n        vv?.addEventListener('resize', onResize);\r\n        vv?.addEventListener('scroll', onResize);\r\n\r\n        const onFs = () => requestAnimationFrame(resizeToHost);\r\n        document.addEventListener('fullscreenchange', onFs);\r\n\r\n        requestAnimationFrame(resizeToHost);\r\n\r\n        cleanupRef.current = () => {\r\n          const instAny = q5Ref.current as any;\r\n          if (instAny && typeof instAny._pointerCleanup === 'function') {\r\n            try { instAny._pointerCleanup(); } catch {}\r\n          }\r\n          if (io) io.disconnect();\r\n          if (onResize) window.removeEventListener('resize', onResize);\r\n          document.removeEventListener('fullscreenchange', onFs);\r\n          ro?.disconnect();\r\n          vv?.removeEventListener('resize', onResize);\r\n          vv?.removeEventListener('scroll', onResize);\r\n          if (q5Ref.current?.remove) q5Ref.current.remove();\r\n          q5Ref.current = null;\r\n          el.replaceChildren();\r\n        };\r\n      });\r\n    });\r\n\r\n    return () => {\r\n      alive = false;\r\n      cleanupRef.current?.();\r\n      cleanupRef.current = null;\r\n    };\r\n  }, []); // run once\r\n\r\n  return <div className=\"evade-the-rock\" ref={hostRef} style={{ width: '100vw', height: '100dvh' }} />;\r\n}\r\n"],"names":["useEffect","useRef","useRealMobileViewport","jsx","_jsx","GameCanvas","onCoinsChange","highScore","onGameOver","onReady","pauseWhenHidden","demoMode","overlayActive","allowSpawns","hostRef","q5Ref","visibleRef","cleanupRef","coinsChangeRef","gameOverRef","readyRef","highScoreRef","pauseHiddenRef","demoRef","overlayRef","allowSpawnsRef","current","isRealMobile","alive","io","onResize","then","q5mod","q5","default","el","isConnected","replaceChildren","remove","sketch","p","verticalMode","rectangles","octagons","particles","projectiles","circle","lastSpawnTime","lastOctagonSpawnTime","rectangleSpawnRate","coins","gameOver","prevGameOver","lastDemoFlag","lastFiredTime","Infinity","cooldownDuration","cooldownRadiusMax","MAX_PARTICLES","MAX_PROJECTILES","MAX_RECTANGLES","dragPointerId","lastTouch","primaryCandidateId","primaryTapInfo","tapCandidates","Map","TAP_MS","TAP_MOVE","DRAG_PROMOTE","baseImpulse","movingUp","movingDown","movingLeft","movingRight","GOLD_COLORS","canSpawn","restartGame","Circle","height","millis","setup","w","offsetWidth","h","offsetHeight","pixelDensity","frameRate","createCanvas","style","touchAction","canvas","overscrollBehavior","webkitUserSelect","userSelect","getCanvasCoords","e","r","getBoundingClientRect","x","clientX","left","width","y","clientY","top","promoteToDrag","pointerId","setPointerCapture","onDown","x0","y0","t0","set","preventDefault","onMove","moved","Math","hypot","dx","dy","dist","speedFactor","log2","force","vx","vy","ti","get","tryFire","now","push","Projectile","length","splice","onUp","releasePointerCapture","dt","delete","onCancel","addEventListener","passive","_pointerCleanup","removeEventListener","window","innerWidth","innerHeight","color","restart","draw","demo","ax","ay","background","delta","deltaTime","stopHorizontal","stopVertical","autoEvade","moveUp","moveDown","moveLeft","moveRight","update","display","spawnRectangles","updateRectangles","spawnOctagons","updateOctagons","blendMode","ADD","i","part","isDead","BLEND","proj","isNewHigh","drawCooldownRing","evadeX","evadeY","danger","rect","cx","cy","distSq","sqrt","weight","attractX","attractY","target","reduce","a","b","da","size","db","d","elapsed","progress","radius","noStroke","fill","ellipse","inView","filter","maxRectangles","Shape","isNaN","overlaps","j","projSize","projX","projY","projW","projH","RectangleProjectile","random","burstRectangles","off","r1","r2","resolveCollision","k","angle","TWO_PI","speed","cos","sin","buffer","o","Particle","c","abs","numParticles","whole","floor","frac","keyPressed","key","keyCode","UP_ARROW","DOWN_ARROW","LEFT_ARROW","RIGHT_ARROW","keyReleased","constructor","trail","pow","createVector","shift","lim","constrain","pos","map","other","isOctagon","rotation","rotationSpeed","startOff","isOct","vertical","reset","baseX","translate","rotate","radians","drawOctagon","rectMode","CENTER","pop","step","beginShape","ang","px","py","vertex","endShape","CLOSE","w1","h1","w2","h2","overlapX","min","max","overlapY","lifespan","srcVx","srcVy","mul","srcSpeed","levels","minSpeed","maxSpeed","targetSpeed","acceleration","mag","alpha","t","factor","maxLifespan","requestAnimationFrame","instance","err","console","error","IntersectionObserver","entry","isIntersecting","loop","noLoop","threshold","observe","ro","vv","visualViewport","lastW","lastH","resizeToHost","host","inst","resizeCanvas","round","warn","ResizeObserver","onFs","document","instAny","disconnect","className","ref"],"sourceRoot":""}