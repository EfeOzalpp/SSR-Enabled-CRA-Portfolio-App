{"version":3,"file":"src_components_rock-escapade_game-canvas_tsx.server.js","mappings":"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","sources":["webpack://personal-site/./src/components/rock-escapade/game-canvas.tsx"],"sourcesContent":["// src/components/rock-escapade/GameCanvas.tsx\r\nimport { useEffect, useRef } from 'react';\r\nimport { useRealMobileViewport } from '../../utils/content-utility/real-mobile';\r\n\r\ntype Props = {\r\n  onCoinsChange?: (coins: number) => void;\r\n  highScore?: number;\r\n  onGameOver?: (finalCoins: number, isNewHigh: boolean) => void;\r\n  onReady?: (api: { restart: () => void }) => void;\r\n  pauseWhenHidden?: boolean;\r\n  demoMode?: boolean;\r\n  overlayActive?: boolean;\r\n  allowSpawns?: boolean;\r\n};\r\n\r\nexport default function GameCanvas({\r\n  onCoinsChange,\r\n  highScore = 0,\r\n  onGameOver,\r\n  onReady,\r\n  pauseWhenHidden = true,\r\n  demoMode = false,\r\n  overlayActive = false,\r\n  allowSpawns = true,\r\n}: Props) {\r\n  const hostRef = useRef<HTMLDivElement>(null);\r\n  const q5Ref = useRef<any>(null);\r\n  const visibleRef = useRef(true);\r\n  const cleanupRef = useRef<(() => void) | null>(null);\r\n\r\n  // prop refs\r\n  const coinsChangeRef = useRef(onCoinsChange);\r\n  const gameOverRef = useRef(onGameOver);\r\n  const readyRef = useRef(onReady);\r\n  const highScoreRef = useRef(highScore);\r\n  const pauseHiddenRef = useRef(pauseWhenHidden);\r\n  const demoRef = useRef(!!demoMode);\r\n  const overlayRef = useRef(!!overlayActive);\r\n  const allowSpawnsRef = useRef(allowSpawns);\r\n\r\n  coinsChangeRef.current = onCoinsChange;\r\n  gameOverRef.current = onGameOver;\r\n  readyRef.current = onReady;\r\n  highScoreRef.current = highScore;\r\n  pauseHiddenRef.current = pauseWhenHidden;\r\n  demoRef.current = !!demoMode;\r\n  overlayRef.current = !!overlayActive;\r\n  allowSpawnsRef.current = !!allowSpawns;\r\n\r\n  const isRealMobile = useRealMobileViewport();\r\n\r\n  useEffect(() => {\r\n    let alive = true;\r\n    let io: IntersectionObserver | null = null;\r\n    let onResize: (() => void) | null = null;\r\n\r\n    import('q5').then((q5mod) => {\r\n      if (!alive) return;\r\n      const q5 = (q5mod as any).default ?? (q5mod as any);\r\n\r\n      const el = hostRef.current;\r\n      if (!el || !el.isConnected) return;\r\n\r\n      // clear any old instance/canvas\r\n      el.replaceChildren();\r\n      if (q5Ref.current?.remove) {\r\n        try { q5Ref.current.remove(); } catch {}\r\n        q5Ref.current = null;\r\n      }\r\n\r\n      const sketch = (p: any) => {\r\n        // ---------------- Local state ----------------\r\n        let verticalMode = false;\r\n        let rectangles: any[] = [];\r\n        let octagons: any[] = [];\r\n        let particles: any[] = [];\r\n        let projectiles: any[] = [];\r\n        let circle: any;\r\n        let lastSpawnTime = 0;\r\n        let lastOctagonSpawnTime = 0;\r\n        let rectangleSpawnRate = 2;\r\n        let coins = 0;\r\n        let gameOver = false;\r\n        let prevGameOver = false;\r\n        let lastDemoFlag = true;\r\n\r\n        let lastFiredTime = -Infinity;\r\n        const cooldownDuration = 1500;\r\n        const cooldownRadiusMax = 48;\r\n\r\n        // perf caps\r\n        const MAX_PARTICLES = isRealMobile ? 600 : 1200;\r\n        const MAX_PROJECTILES = 140;\r\n        const MAX_RECTANGLES = 220;\r\n\r\n        // ---------- Pointer gesture state ----------\r\n        let dragPointerId: number | null = null;\r\n        let lastTouch: { x: number; y: number } | null = null;\r\n\r\n        let primaryCandidateId: number | null = null;\r\n        type TapInfo = { x0: number; y0: number; x: number; y: number; t0: number };\r\n        let primaryTapInfo: TapInfo | null = null;\r\n\r\n        const tapCandidates = new Map<number, TapInfo>();\r\n\r\n        // thresholds\r\n        const TAP_MS = 180;\r\n        const TAP_MOVE = 12;     // also used as drag promotion threshold\r\n        const DRAG_PROMOTE = TAP_MOVE;\r\n        const baseImpulse = isRealMobile ? 0.5 : 0.35;\r\n\r\n        let movingUp = false;\r\n        let movingDown = false;\r\n        let movingLeft = false;\r\n        let movingRight = false;\r\n\r\n        // cached colors\r\n        let GOLD_COLORS: any[] = [];\r\n\r\n        // small scratch object to avoid GC in getCanvasCoords\r\n        const scratchXY = { x: 0, y: 0 };\r\n\r\n        function canSpawn() {\r\n          return demoRef.current || allowSpawnsRef.current;\r\n        }\r\n\r\n        // ---------------- API ----------------\r\n        const restartGame = () => {\r\n          gameOver = false;\r\n          coins = 0;\r\n          coinsChangeRef.current?.(coins);\r\n          rectangles.length = 0;\r\n          octagons.length = 0;\r\n          particles.length = 0;\r\n          projectiles.length = 0;\r\n          circle = new Circle(p, 240, p.height / 2, 33);\r\n          (q5Ref.current as any).circle = circle;\r\n          lastOctagonSpawnTime = p.millis();\r\n        };\r\n        (p as any).restartGame = restartGame;\r\n\r\n        // ---------------- Setup ----------------\r\n        p.setup = () => {\r\n          const w = el.offsetWidth;\r\n          const h = el.offsetHeight;\r\n\r\n          if (isRealMobile && p.pixelDensity) p.pixelDensity(1);\r\n          p.frameRate?.(60);\r\n          p.createCanvas(w, h);\r\n\r\n          // keep the page from stealing gestures\r\n          (el as HTMLElement).style.touchAction = 'none';\r\n          (p as any).canvas.style.touchAction = 'none';\r\n          (el as HTMLElement).style.overscrollBehavior = 'none';\r\n          (el as HTMLElement).style.webkitUserSelect = 'none';\r\n          (el as HTMLElement).style.userSelect = 'none';\r\n\r\n          const canvas = (p as any).canvas as HTMLCanvasElement;\r\n\r\n          const getCanvasCoords = (e: PointerEvent) => {\r\n            const r = canvas.getBoundingClientRect();\r\n            scratchXY.x = (e.clientX - r.left) * (p.width / r.width);\r\n            scratchXY.y = (e.clientY - r.top) * (p.height / r.height);\r\n            return scratchXY;\r\n          };\r\n\r\n          const promoteToDrag = (pointerId: number, x: number, y: number) => {\r\n            dragPointerId = pointerId;\r\n            lastTouch = { x, y };\r\n            try { canvas.setPointerCapture(pointerId); } catch {}\r\n          };\r\n\r\n          // ----- handlers -----\r\n          const onDown = (e: PointerEvent) => {\r\n            if (demoRef.current || overlayRef.current) return;\r\n            const { x, y } = getCanvasCoords(e);\r\n\r\n            if (dragPointerId === null && primaryCandidateId === null) {\r\n              primaryCandidateId = e.pointerId;\r\n              primaryTapInfo = { x0: x, y0: y, x, y, t0: p.millis() };\r\n            } else {\r\n              tapCandidates.set(e.pointerId, { x0: x, y0: y, x, y, t0: p.millis() });\r\n            }\r\n            e.preventDefault();\r\n          };\r\n\r\n          const onMove = (e: PointerEvent) => {\r\n            if (demoRef.current || overlayRef.current) return;\r\n            const { x, y } = getCanvasCoords(e);\r\n\r\n            // Candidate → promote to drag when moved enough\r\n            if (primaryCandidateId === e.pointerId && dragPointerId === null) {\r\n              if (primaryTapInfo) { primaryTapInfo.x = x; primaryTapInfo.y = y; }\r\n              const dx0 = x - (primaryTapInfo?.x0 ?? x);\r\n              const dy0 = y - (primaryTapInfo?.y0 ?? y);\r\n              const moved = Math.hypot(dx0, dy0);\r\n              if (moved > DRAG_PROMOTE) {\r\n                promoteToDrag(e.pointerId, x, y);\r\n                primaryCandidateId = null;\r\n                primaryTapInfo = null;\r\n              }\r\n              e.preventDefault();\r\n              return;\r\n            }\r\n\r\n            // Active drag: only this pointer moves the ship\r\n            if (e.pointerId === dragPointerId) {\r\n              if (!lastTouch || !circle) { lastTouch = { x, y }; e.preventDefault(); return; }\r\n              const dx = x - lastTouch.x;\r\n              const dy = y - lastTouch.y;\r\n              const dist = Math.hypot(dx, dy) || 1;\r\n              const speedFactor = Math.log2(dist + 1);\r\n              const force = baseImpulse * speedFactor;\r\n              circle.vx += (dx / dist) * force;\r\n              circle.vy += (dy / dist) * force;\r\n              lastTouch = { x, y };\r\n              e.preventDefault();\r\n              return;\r\n            }\r\n\r\n            // Secondary tap candidates: track movement for tap thresholding\r\n            const ti = tapCandidates.get(e.pointerId);\r\n            if (ti) { ti.x = x; ti.y = y; }\r\n            e.preventDefault();\r\n          };\r\n\r\n          const tryFire = () => {\r\n            const now = p.millis();\r\n            if (now - lastFiredTime >= cooldownDuration) {\r\n              lastFiredTime = now;\r\n              const vx = (circle.vx !== 0 || circle.vy !== 0) ? circle.vx : 5;\r\n              const vy = (circle.vy !== 0 || circle.vx !== 0) ? circle.vy : 0;\r\n              projectiles.push(new Projectile(p, circle.x, circle.y, vx, vy));\r\n              if (projectiles.length > MAX_PROJECTILES) {\r\n                projectiles.splice(0, projectiles.length - MAX_PROJECTILES);\r\n              }\r\n            }\r\n          };\r\n\r\n          const onUp = (e: PointerEvent) => {\r\n            if (demoRef.current || overlayRef.current) return;\r\n\r\n            // End drag only if the drag pointer lifted\r\n            if (e.pointerId === dragPointerId) {\r\n              try { canvas.releasePointerCapture(e.pointerId); } catch {}\r\n              dragPointerId = null;\r\n              lastTouch = null;\r\n              e.preventDefault();\r\n              return;\r\n            }\r\n\r\n            // Primary candidate ended without being promoted → evaluate as tap\r\n            if (primaryCandidateId === e.pointerId && dragPointerId === null) {\r\n              const ti = primaryTapInfo;\r\n              primaryCandidateId = null;\r\n              primaryTapInfo = null;\r\n              if (ti) {\r\n                const dt = p.millis() - ti.t0;\r\n                const moved = Math.hypot(ti.x - ti.x0, ti.y - ti.y0);\r\n                if (dt <= TAP_MS && moved <= TAP_MOVE) tryFire();\r\n              }\r\n              e.preventDefault();\r\n              return;\r\n            }\r\n\r\n            // Secondary tap candidate → evaluate as tap\r\n            const ti = tapCandidates.get(e.pointerId);\r\n            if (ti) {\r\n              tapCandidates.delete(e.pointerId);\r\n              const dt = p.millis() - ti.t0;\r\n              const moved = Math.hypot(ti.x - ti.x0, ti.y - ti.y0);\r\n              if (dt <= TAP_MS && moved <= TAP_MOVE) tryFire(); // does NOT affect drag\r\n              e.preventDefault();\r\n            }\r\n          };\r\n\r\n          const onCancel = (e: PointerEvent) => {\r\n            // Clean up states safely\r\n            if (e.pointerId === dragPointerId) {\r\n              dragPointerId = null;\r\n              lastTouch = null;\r\n            }\r\n            if (primaryCandidateId === e.pointerId) {\r\n              primaryCandidateId = null;\r\n              primaryTapInfo = null;\r\n            }\r\n            tapCandidates.delete(e.pointerId);\r\n          };\r\n\r\n          canvas.addEventListener('pointerdown', onDown, { passive: false });\r\n          canvas.addEventListener('pointermove', onMove, { passive: false });\r\n          canvas.addEventListener('pointerup', onUp, { passive: false });\r\n          canvas.addEventListener('pointercancel', onCancel as any, { passive: false });\r\n          canvas.addEventListener('lostpointercapture', (e: any) => {\r\n            if (e.pointerId === dragPointerId) {\r\n              dragPointerId = null;\r\n              lastTouch = null;\r\n            }\r\n          });\r\n\r\n          (p as any)._pointerCleanup = () => {\r\n            try {\r\n              canvas.removeEventListener('pointerdown', onDown as any);\r\n              canvas.removeEventListener('pointermove', onMove as any);\r\n              canvas.removeEventListener('pointerup', onUp as any);\r\n              canvas.removeEventListener('pointercancel', onCancel as any);\r\n            } catch {}\r\n          };\r\n\r\n          verticalMode = window.innerWidth <= 1024 && window.innerHeight > window.innerWidth;\r\n\r\n          GOLD_COLORS = [\r\n            p.color(255, 215, 0),\r\n            p.color(255, 223, 70),\r\n            p.color(255, 200, 0),\r\n            p.color(255, 170, 50),\r\n          ];\r\n\r\n          lastOctagonSpawnTime = p.millis();\r\n          circle = new Circle(p, 240, h / 2, 33);\r\n          (q5Ref.current as any).circle = circle;\r\n\r\n          readyRef.current?.({ restart: restartGame });\r\n        };\r\n\r\n        // ---------------- Draw loop ----------------\r\n        p.draw = () => {\r\n          const demo = demoRef.current;\r\n\r\n          // detect demo → live transition\r\n          if (!demo && lastDemoFlag) {\r\n            rectangles.length = 0;\r\n            octagons.length = 0;\r\n            particles.length = 0;\r\n            projectiles.length = 0;\r\n            coins = 0;\r\n            coinsChangeRef.current?.(0);\r\n\r\n            circle.x = 240;\r\n            circle.y = p.height / 2;\r\n            circle.vx = circle.vy = circle.ax = circle.ay = 0;\r\n\r\n            const now = p.millis();\r\n            lastOctagonSpawnTime = now;\r\n            lastSpawnTime = now;\r\n          }\r\n          lastDemoFlag = demo;\r\n\r\n          if (pauseHiddenRef.current && !visibleRef.current) {\r\n            p.background(28);\r\n            return;\r\n          }\r\n\r\n          const delta = p.deltaTime / 16.67;\r\n          const nowMillis = p.millis();\r\n          const vw = p.width;\r\n          const vh = p.height;\r\n\r\n          p.background(28);\r\n\r\n          if (!demo && overlayRef.current) {\r\n            movingUp = movingDown = movingLeft = movingRight = false;\r\n            circle.stopHorizontal();\r\n            circle.stopVertical();\r\n          }\r\n\r\n          if (demo) {\r\n            autoEvade();\r\n          } else {\r\n            if (movingUp) circle.moveUp(); else if (movingDown) circle.moveDown(); else circle.stopVertical();\r\n            if (movingLeft) circle.moveLeft(); else if (movingRight) circle.moveRight(); else circle.stopHorizontal();\r\n          }\r\n\r\n          circle.update(delta, vw, vh);\r\n          circle.display(p);\r\n\r\n          spawnRectangles(p, nowMillis, vw, vh);\r\n          updateRectangles(p, delta, nowMillis, vw, vh);\r\n\r\n          spawnOctagons(p, nowMillis);\r\n          updateOctagons(p, delta, vw, vh);\r\n\r\n          if (!isRealMobile) p.blendMode(p.ADD);\r\n          // update & draw particles\r\n          for (let i = particles.length - 1; i >= 0; i--) {\r\n            const part = particles[i];\r\n            part.update(delta);\r\n            part.display(p);\r\n            if (part.isDead()) particles.splice(i, 1);\r\n          }\r\n          if (!isRealMobile) p.blendMode(p.BLEND);\r\n\r\n          // projectiles\r\n          for (let i = projectiles.length - 1; i >= 0; i--) {\r\n            const proj = projectiles[i];\r\n            proj.update(delta, vw, vh);\r\n            proj.display(p);\r\n            if (proj.isDead(vw, vh)) projectiles.splice(i, 1);\r\n          }\r\n\r\n          // live-mode only HUD & game-over\r\n          if (!demo) {\r\n            if (!prevGameOver && gameOver) {\r\n              const isNewHigh = coins > (highScoreRef.current ?? 0);\r\n              gameOverRef.current?.(coins, isNewHigh);\r\n            }\r\n            prevGameOver = gameOver;\r\n\r\n            if (gameOver) { p.background(28, 180); return; }\r\n            drawCooldownRing(p, nowMillis);\r\n          } else {\r\n            gameOver = false; // demo never ends\r\n          }\r\n\r\n          // --- helpers (closed over locals) ---\r\n          function drawCooldownRing(pAny: any, now: number) {\r\n            const elapsed = now - lastFiredTime;\r\n            if (elapsed >= cooldownDuration) return;\r\n            const progress = 1 - (elapsed / cooldownDuration);\r\n            const radius = progress * cooldownRadiusMax;\r\n            pAny.noStroke();\r\n            pAny.fill(200, 150, 255, 100);\r\n            pAny.ellipse(circle.x, circle.y, radius * 2, radius * 2);\r\n          }\r\n        };\r\n\r\n        // --- Demo simple AI: evade rectangles, seek octagons\r\n        function autoEvade() {\r\n          let evadeX = 0, evadeY = 0, danger = 0;\r\n\r\n          for (const rect of rectangles) {\r\n            const cx = rect.x + rect.w / 2;\r\n            const cy = rect.y + rect.h / 2;\r\n            const dx = circle.x - cx;\r\n            const dy = circle.y - cy;\r\n            const distSq = dx * dx + dy * dy;\r\n            if (distSq < 20000) {\r\n              const dist = Math.sqrt(distSq) || 1;\r\n              const weight = 1 / (dist + 300);\r\n              const force = weight * 150;\r\n              evadeX += (dx / dist) * force;\r\n              evadeY += (dy / dist) * force;\r\n              danger += (1 / (dist + 1)) * 10;\r\n            }\r\n          }\r\n\r\n          let attractX = 0, attractY = 0;\r\n          if (octagons.length > 0 && danger < 50) {\r\n            const target = octagons.reduce((a, b) => {\r\n              const da = Math.hypot(circle.x - (a.x + a.size / 2), circle.y - (a.y + a.size / 2));\r\n              const db = Math.hypot(circle.x - (b.x + b.size / 2), circle.y - (b.y + b.size / 2));\r\n              return db < da ? b : a;\r\n            });\r\n            const dx = (target.x + target.size / 2) - circle.x;\r\n            const dy = (target.y + target.size / 2) - circle.y;\r\n            const d = Math.hypot(dx, dy) || 1;\r\n            attractX = (dx / d) * 0.45;\r\n            attractY = (dy / d) * 0.45;\r\n          }\r\n\r\n          circle.ax = evadeX + attractX;\r\n          circle.ay = evadeY + attractY;\r\n\r\n          if (circle.ax === 0 && circle.ay === 0) {\r\n            const cx = p.width / 2 - circle.x;\r\n            const cy = p.height / 2 - circle.y;\r\n            const d = Math.hypot(cx, cy) || 1;\r\n            circle.ax = (cx / d) * 0.1;\r\n            circle.ay = (cy / d) * 0.1;\r\n          }\r\n        }\r\n\r\n        // ---------------- Spawners/Updaters ----------------\r\n        function spawnRectangles(p: any, now: number, vw: number, vh: number) {\r\n          if (!allowSpawnsRef.current) return;\r\n          if (!canSpawn()) return;\r\n\r\n          const inView = rectangles.filter((r) =>\r\n            verticalMode ? r.y + r.h > 0 && r.y < vh : r.x + r.w > 0 && r.x < vw\r\n          ).length;\r\n\r\n          let maxRectangles: number;\r\n          const ww = window.innerWidth;\r\n          const wh = window.innerHeight;\r\n          if (ww >= 1025) {\r\n            maxRectangles = 50;\r\n            if (inView < 10) rectangleSpawnRate = 6;\r\n            else if (inView < 25) rectangleSpawnRate = 5;\r\n            else if (inView < 40) rectangleSpawnRate = 4;\r\n            else rectangleSpawnRate = 0;\r\n          } else if (ww >= 768) {\r\n            maxRectangles = 60;\r\n            if (inView < 8) rectangleSpawnRate = 5;\r\n            else if (inView < 20) rectangleSpawnRate = 4;\r\n            else if (inView < 40) rectangleSpawnRate = 3;\r\n            else rectangleSpawnRate = 0;\r\n          } else {\r\n            maxRectangles = 25;\r\n            if (inView < 10) rectangleSpawnRate = 4;\r\n            else if (inView < 20) rectangleSpawnRate = 3;\r\n            else rectangleSpawnRate = 1;\r\n          }\r\n\r\n          if (rectangleSpawnRate > 0 && now - lastSpawnTime > 2000 / rectangleSpawnRate && inView < maxRectangles) {\r\n            rectangles.push(new Shape(p, true, false, verticalMode, GOLD_COLORS));\r\n            lastSpawnTime = now;\r\n          }\r\n\r\n          if (rectangles.length > MAX_RECTANGLES) rectangles.splice(0, rectangles.length - MAX_RECTANGLES);\r\n\r\n          if (now % 5000 < 20) {\r\n            rectangles = rectangles.filter((r) => !isNaN(r.x) && !isNaN(r.y));\r\n          }\r\n        }\r\n\r\n        function updateRectangles(p: any, delta: number, now: number, vw: number, vh: number) {\r\n          for (let i = rectangles.length - 1; i >= 0; i--) {\r\n            const r = rectangles[i];\r\n            r.update(delta);\r\n            r.display(p);\r\n            if (!demoRef.current && circle.overlaps(r)) gameOver = true;\r\n\r\n            // projectile collision\r\n            for (let j = projectiles.length - 1; j >= 0; j--) {\r\n              const proj = projectiles[j];\r\n              const projSize = (proj.size ?? proj.radius * 2);\r\n              const projX = proj.x - (proj.size ? proj.size / 2 : proj.radius);\r\n              const projY = proj.y - (proj.size ? proj.size / 2 : proj.radius);\r\n              const projW = projSize;\r\n              const projH = projSize;\r\n\r\n              if (\r\n                projX + projW > r.x &&\r\n                projX < r.x + r.w &&\r\n                projY + projH > r.y &&\r\n                projY < r.y + r.h\r\n              ) {\r\n                if (proj instanceof RectangleProjectile) {\r\n                  if (p.random() < 0.05) {\r\n                    rectangles.splice(i, 1);\r\n                    projectiles.splice(j, 1);\r\n                    burstRectangles(p, r.x + r.w / 2, r.y + r.h / 2);\r\n                  } else {\r\n                    proj.vx *= -1;\r\n                    proj.vy *= -1;\r\n                    proj.x += proj.vx * delta * 2;\r\n                    proj.y += proj.vy * delta * 2;\r\n                  }\r\n                } else {\r\n                  rectangles.splice(i, 1);\r\n                  projectiles.splice(j, 1);\r\n                  burstRectangles(p, r.x + r.w / 2, r.y + r.h / 2);\r\n                }\r\n                break;\r\n              }\r\n            }\r\n\r\n            const off = verticalMode\r\n              ? r.y - r.h > vh + 100 || r.y + r.h < -100\r\n              : r.x + r.w < -100 || r.x - r.w > vw + 100;\r\n\r\n            if (off) {\r\n              rectangles.splice(i, 1);\r\n              continue;\r\n            }\r\n          }\r\n\r\n          // resolve collisions (unchanged logic)\r\n          for (let i = 0; i < rectangles.length; i++) {\r\n            const r1 = rectangles[i];\r\n            for (let j = i + 1; j < rectangles.length; j++) {\r\n              const r2 = rectangles[j];\r\n              if (r1.overlaps(r2)) r1.resolveCollision(r2);\r\n            }\r\n          }\r\n        }\r\n\r\n        function burstRectangles(p: any, cx: number, cy: number) {\r\n          for (let k = 0; k < 8; k++) {\r\n            const angle = (p.TWO_PI / 8) * k;\r\n            const speed = p.random(2, 4);\r\n            const vx = Math.cos(angle) * speed;\r\n            const vy = Math.sin(angle) * speed;\r\n            projectiles.push(new RectangleProjectile(p, cx, cy, vx, vy, '#c896ff'));\r\n          }\r\n          if (projectiles.length > MAX_PROJECTILES) projectiles.splice(0, projectiles.length - MAX_PROJECTILES);\r\n        }\r\n\r\n        function spawnOctagons(p: any, now: number) {\r\n          if (!allowSpawnsRef.current) return;\r\n          if (!canSpawn()) return;\r\n          if (now - lastOctagonSpawnTime > 2000) {\r\n            if (octagons.length === 0) octagons.push(new Shape(p, true, true, verticalMode, GOLD_COLORS));\r\n            lastOctagonSpawnTime = now;\r\n          }\r\n        }\r\n\r\n        function updateOctagons(p: any, delta: number, vw: number, vh: number) {\r\n          const buffer = 150;\r\n\r\n          for (let i = octagons.length - 1; i >= 0; i--) {\r\n            const o = octagons[i];\r\n            o.update(delta);\r\n            o.display(p);\r\n\r\n            if (circle.overlaps(o)) {\r\n              if (!demoRef.current) {\r\n                coins += 20;\r\n                coinsChangeRef.current?.(coins);\r\n              }\r\n              for (let j = 0; j < 10; j++) {\r\n                particles.push(new Particle(p, o.x + o.size / 2, o.y + o.size / 2, 255, o.c, 0, 0, 5));\r\n              }\r\n              if (particles.length > MAX_PARTICLES) particles.splice(0, particles.length - MAX_PARTICLES);\r\n              octagons.splice(i, 1);\r\n              continue;\r\n            }\r\n\r\n            const speed = Math.abs(o.vx) + Math.abs(o.vy);\r\n            let numParticles: number;\r\n            if (speed < 1) numParticles = 0.05;\r\n            else if (speed < 3) numParticles = 0.1;\r\n            else if (speed < 6) numParticles = 0.2;\r\n            else numParticles = 0.3;\r\n\r\n            const whole = Math.floor(numParticles);\r\n            const frac = numParticles - whole;\r\n\r\n            for (let j = 0; j < whole; j++) particles.push(new Particle(p, o.x + o.size / 2, o.y + o.size / 2, 255, o.c));\r\n            if (p.random() < frac) particles.push(new Particle(p, o.x + o.size / 2, o.y + o.size / 2, 255, o.c));\r\n            if (particles.length > MAX_PARTICLES) particles.splice(0, particles.length - MAX_PARTICLES);\r\n\r\n            if (\r\n              o.x + o.size < -buffer ||\r\n              o.x - o.size > vw + buffer ||\r\n              o.y + o.size < -buffer ||\r\n              o.y - o.size > vh + buffer\r\n            ) {\r\n              octagons.splice(i, 1);\r\n            }\r\n          }\r\n        }\r\n\r\n        // ---------------- Keyboard ----------------\r\n        p.keyPressed = () => {\r\n          if (demoRef.current || overlayRef.current) return;\r\n          if (p.key === ' ' || p.key === 'Spacebar') {\r\n            const now = p.millis();\r\n            if (now - lastFiredTime >= cooldownDuration) {\r\n              lastFiredTime = now;\r\n              if (circle) {\r\n                const vx = (circle.vx !== 0 || circle.vy !== 0) ? circle.vx : 5;\r\n                const vy = (circle.vy !== 0 || circle.vx !== 0) ? circle.vy : 0;\r\n                projectiles.push(new Projectile(p, circle.x, circle.y, vx, vy));\r\n                if (projectiles.length > MAX_PROJECTILES) projectiles.splice(0, projectiles.length - MAX_PROJECTILES);\r\n              }\r\n            }\r\n          }\r\n          if (p.key === 'w' || p.keyCode === p.UP_ARROW)    movingUp = true;\r\n          if (p.key === 's' || p.keyCode === p.DOWN_ARROW)  movingDown = true;\r\n          if (p.key === 'a' || p.keyCode === p.LEFT_ARROW)  movingLeft = true;\r\n          if (p.key === 'd' || p.keyCode === p.RIGHT_ARROW) movingRight = true;\r\n        };\r\n\r\n        p.keyReleased = () => {\r\n          if (demoRef.current || overlayRef.current) return;\r\n          if (p.key === 'w' || p.keyCode === p.UP_ARROW)    movingUp = false;\r\n          if (p.key === 's' || p.keyCode === p.DOWN_ARROW)  movingDown = false;\r\n          if (p.key === 'a' || p.keyCode === p.LEFT_ARROW)  movingLeft = false;\r\n          if (p.key === 'd' || p.keyCode === p.RIGHT_ARROW) movingRight = false;\r\n        };\r\n\r\n        // ---------------- Classes ----------------\r\n        class Circle {\r\n          p:any;x:number;y:number;vx:number;vy:number;ax:number;ay:number;radius:number;c:any;trail:{x:number;y:number}[];\r\n          constructor(p:any,x:number,y:number,r:number){\r\n            this.p=p;this.x=x;this.y=y;this.vx=0;this.vy=0;this.ax=0;this.ay=0;this.radius=r;this.c=p.color(200,150,255);this.trail=[];\r\n          }\r\n          update(delta:number, vw:number, vh:number){\r\n            this.vx+=this.ax*delta;this.vy+=this.ay*delta;\r\n            // damping\r\n            const damp = Math.pow(0.92,delta);\r\n            this.vx*=damp;this.vy*=damp;\r\n            this.x+=this.vx*delta;this.y+=this.vy*delta;\r\n\r\n            // wrap\r\n            if(this.y+this.radius<0)this.y=vh+this.radius;else if(this.y-this.radius>vh)this.y=-this.radius;\r\n            if(this.x+this.radius<0)this.x=vw+this.radius;else if(this.x-this.radius>vw)this.x=-this.radius;\r\n\r\n            // cheap trail (no p.createVector allocs)\r\n            this.trail.push({x:this.x,y:this.y});\r\n            if(this.trail.length>8)this.trail.shift();\r\n\r\n            // clamp\r\n            const lim=10;\r\n            if(this.vx<-lim)this.vx=-lim; else if(this.vx>lim)this.vx=lim;\r\n            if(this.vy<-lim)this.vy=-lim; else if(this.vy>lim)this.vy=lim;\r\n          }\r\n          display(pAny:any){\r\n            const n=this.trail.length;\r\n            for(let i=0;i<n;i++){\r\n              const pos=this.trail[i];\r\n              const a=pAny.map(i,0,n-1,30,100);\r\n              const r=pAny.map(i,0,n-1,this.radius/2,this.radius);\r\n              pAny.fill(200,150,255,a);pAny.noStroke();pAny.ellipse(pos.x,pos.y,r,r);\r\n            }\r\n            pAny.fill(this.c);pAny.noStroke();pAny.ellipse(this.x,this.y,this.radius,this.radius);\r\n          }\r\n          moveUp(){this.ay=-0.5;}moveDown(){this.ay=0.5;}moveLeft(){this.ax=-0.5;}moveRight(){this.ax=0.5;}stopVertical(){this.ay=0;}stopHorizontal(){this.ax=0;}\r\n          overlaps(other:any){\r\n            if(other.isOctagon){\r\n              const dx=this.x-(other.x+other.size/2);\r\n              const dy=this.y-(other.y+other.size/2);\r\n              const sumR=this.radius+other.size/2;\r\n              return dx*dx+dy*dy < sumR*sumR;\r\n            }\r\n            const cx = Math.max(other.x, Math.min(this.x, other.x+other.w));\r\n            const cy = Math.max(other.y, Math.min(this.y, other.y+other.h));\r\n            const dx = this.x-cx, dy=this.y-cy;\r\n            const r = this.radius*0.3; // unchanged gameplay fudge\r\n            return dx*dx+dy*dy < r*r;\r\n          }\r\n        }\r\n\r\n        class Shape {\r\n          p:any;isOctagon:boolean;verticalMode:boolean;x=0;y=0;vx=0;vy=0;w=0;h=0;size=0;c:any;rotation=0;rotationSpeed=0;\r\n          private GOLD:any[];\r\n          constructor(p:any,startOff:boolean,isOct:boolean,vertical:boolean, GOLD:any[]){this.p=p;this.isOctagon=isOct;this.verticalMode=vertical;this.GOLD=GOLD;this.reset(startOff);}\r\n          reset(startOff:boolean){\r\n            const ww = window.innerWidth;\r\n            const wh = window.innerHeight;\r\n            if(this.verticalMode){\r\n              this.x=this.p.random(this.p.width);\r\n              if(this.isOctagon){\r\n                this.y=startOff?-this.p.random(30,60):this.p.random(this.p.height);this.vx=this.p.random(-1.2,1.2);\r\n                if(this.p.random()<0.1)this.vy=this.p.random(6,9);else if(this.p.random()<0.2)this.vy=this.p.random(0.5,1.5);else this.vy=this.p.random(2,5);\r\n                this.size=25;this.c=this.p.random(this.GOLD);\r\n              } else {\r\n                this.y=startOff?-this.p.random(60,120):this.p.random(this.p.height);this.vx=this.p.random(-0.5,0.5);this.vy=this.p.random(1,3);\r\n                this.w=this.p.random(28,70);this.h=this.p.random(28,70);this.c=this.p.color(235,235,255);\r\n              }\r\n            } else {\r\n              this.x=startOff?this.p.width+this.p.random(10,40):this.p.random(this.p.width);this.y=this.p.random(this.p.height);\r\n              if(this.isOctagon){\r\n                let baseX=this.p.random(-2.5,-0.5);if(ww>=1025&&ww>wh)baseX*=4.5;\r\n                if(this.p.random()<0.1)baseX*=2;else if(this.p.random()<0.2)baseX*=0.5;this.vx=baseX;this.vy=this.p.random(-0.3,0.3);this.size=25;\r\n                this.c=this.p.random(this.GOLD);\r\n              } else {\r\n                this.vx=this.p.random(-3,-1);this.vy=this.p.random(-0.5,0.5);\r\n                if(ww>=1025&&ww>wh){this.w=this.p.random(33,105);this.h=this.p.random(33,105);}\r\n                else{this.w=this.p.random(30,75);this.h=this.p.random(30,75);}this.c=this.p.color(235,235,255);\r\n              }\r\n            }\r\n            this.rotation=0;this.rotationSpeed=this.p.random(-1,1);\r\n          }\r\n          update(delta:number){this.x+=this.vx*delta;this.y+=this.vy*delta;this.rotation+=this.rotationSpeed*delta;}\r\n          display(pAny:any){\r\n            pAny.push();\r\n            pAny.translate(this.x+(this.isOctagon?this.size/2:this.w/2),this.y+(this.isOctagon?this.size/2:this.h/2));\r\n            pAny.rotate(pAny.radians(this.rotation));pAny.fill(this.c);pAny.noStroke();\r\n            if(this.isOctagon)this.drawOctagon(pAny,0,0,this.size);else{pAny.rectMode(pAny.CENTER);pAny.rect(0,0,this.w,this.h);}\r\n            pAny.pop();\r\n          }\r\n          drawOctagon(pAny:any,x:number,y:number,size:number){\r\n            const step=pAny.TWO_PI/8;pAny.beginShape();\r\n            for(let i=0;i<8;i++){const ang=i*step;const px=x+Math.cos(ang)*size/2;const py=y+Math.sin(ang)*size/2;pAny.vertex(px,py);}\r\n            pAny.endShape(pAny.CLOSE);\r\n          }\r\n          overlaps(o:any){\r\n            const w1=this.isOctagon?this.size:this.w;const h1=this.isOctagon?this.size:this.h;const w2=o.isOctagon?o.size:o.w;const h2=o.isOctagon?o.size:o.h;\r\n            return !(this.x+w1<o.x||this.x>o.x+w2||this.y+h1<o.y||this.y>o.y+h2);\r\n          }\r\n          resolveCollision(other:any){\r\n            const w1=this.isOctagon?this.size:this.w;const h1=this.isOctagon?this.size:this.h;const w2=other.isOctagon?other.size:other.w;const h2=other.isOctagon?other.size:other.h;\r\n            const overlapX=Math.min(this.x+w1,other.x+w2)-Math.max(this.x,other.x);const overlapY=Math.min(this.y+h1,other.y+h2)-Math.max(this.y,other.y);\r\n            if(overlapX<overlapY){\r\n              if(this.x<other.x){this.x-=overlapX/2;other.x+=overlapX/2;}else{this.x+=overlapX/2;other.x-=overlapX/2;}this.vx*=-1;other.vx*=-1;\r\n            } else {\r\n              if(this.y<other.y){this.y-=overlapY/2;other.y+=overlapY/2;}else{this.y+=overlapY/2;other.y-=overlapY/2;}this.vy*=-1;other.vy*=-1;\r\n            }\r\n          }\r\n        }\r\n\r\n        class Particle {\r\n          p:any;x:number;y:number;vx:number;vy:number;lifespan:number;c:any;\r\n          constructor(p:any,x:number,y:number,lifespan=255,c=p.color(255,215,0),srcVx=0,srcVy=0,mul:number|null=null){\r\n            this.p=p;this.x=x;this.y=y;this.lifespan=lifespan;this.c=c;\r\n            const srcSpeed=Math.hypot(srcVx,srcVy);\r\n            let speed=p.map(srcSpeed,0,5,1,3);speed=p.constrain(speed,1.2,3.5);if(mul!=null)speed*=mul;\r\n            const ang=p.random(0,p.TWO_PI);this.vx=Math.cos(ang)*speed+srcVx*0.1;this.vy=Math.sin(ang)*speed+srcVy*0.1;\r\n          }\r\n          update(delta:number){this.x+=this.vx*delta;this.y+=this.vy*delta;this.lifespan-=1*delta;}\r\n          display(pAny:any){pAny.noStroke();pAny.fill(this.c.levels[0],this.c.levels[1],this.c.levels[2],this.lifespan);pAny.ellipse(this.x,this.y,4,4);}\r\n          isDead(){return this.lifespan<=0;}\r\n        }\r\n\r\n        class Projectile {\r\n          p:any;x:number;y:number;vx:number;vy:number;ux:number;uy:number;radius:number;lifespan:number;trail:{x:number;y:number;alpha:number}[];color:any;\r\n          minSpeed=0.6;maxSpeed=12;speed=this.minSpeed;targetSpeed=8;acceleration=3;\r\n          constructor(p:any,x:number,y:number,vx:number,vy:number){\r\n            this.p=p;this.x=x;this.y=y;\r\n            const mag=Math.hypot(vx,vy)||1;\r\n            this.ux=vx/mag;this.uy=vy/mag;\r\n            this.vx=this.ux*this.speed;this.vy=this.uy*this.speed;this.radius=6;this.lifespan=500;this.trail=[];this.color=p.color(200,150,255);\r\n          }\r\n          update(delta:number){\r\n            // accelerate speed toward target, direction unchanged\r\n            this.speed+=(this.targetSpeed-this.speed)*this.acceleration*delta;\r\n            if(this.speed<this.minSpeed)this.speed=this.minSpeed;if(this.speed>this.maxSpeed)this.speed=this.maxSpeed;\r\n            this.vx=this.ux*this.speed;this.vy=this.uy*this.speed;\r\n            this.x+=this.vx*delta;this.y+=this.vy*delta;this.lifespan-=1*delta;\r\n            this.trail.push({x:this.x,y:this.y,alpha:160});if(this.trail.length>20)this.trail.shift();\r\n            for(let i=0;i<this.trail.length;i++)this.trail[i].alpha*=0.8;\r\n          }\r\n          display(pAny:any){\r\n            for(let i=0;i<this.trail.length;i++){const t=this.trail[i];pAny.fill(200,150,255,t.alpha);pAny.noStroke();pAny.ellipse(t.x,t.y,this.radius*2,this.radius*2);}\r\n            pAny.fill(this.color);pAny.noStroke();pAny.ellipse(this.x,this.y,this.radius*2,this.radius*2);\r\n          }\r\n          isDead(vw:number,vh:number){return this.lifespan<=0||this.x<0||this.x>vw||this.y<0||this.y>vh;}\r\n        }\r\n\r\n        class RectangleProjectile {\r\n          p:any;x:number;y:number;vx:number;vy:number;size:number;lifespan:number;maxLifespan:number;color:any;rotation:number;rotationSpeed:number;\r\n          constructor(p:any,x:number,y:number,vx:number,vy:number,color:string){\r\n            this.p=p;this.x=x;this.y=y;this.size=p.random(8,20);const factor=this.p.map(this.size,8,20,1,2);this.vx=vx*factor;this.vy=vy*factor;\r\n            this.lifespan=80;this.maxLifespan=this.lifespan;this.color=p.color(color);this.rotation=p.random(360);this.rotationSpeed=p.random(-20,20);\r\n          }\r\n          update(delta:number){this.x+=this.vx*delta;this.y+=this.vy*delta;this.lifespan-=1*delta;this.rotation+=this.rotationSpeed*delta;}\r\n          display(pAny:any){\r\n            pAny.push();pAny.translate(this.x,this.y);pAny.rotate(pAny.radians(this.rotation));\r\n            const a=pAny.map(this.lifespan,0,this.maxLifespan,0,255);pAny.fill(this.color.levels[0],this.color.levels[1],this.color.levels[2],a);\r\n            pAny.noStroke();pAny.rectMode(pAny.CENTER);pAny.rect(0,0,this.size,this.size);pAny.pop();\r\n          }\r\n          isDead(vw:number,vh:number){return this.lifespan<=0||this.x<-50||this.x>vw+50||this.y<-50||this.y>vh+50;}\r\n        }\r\n      }; // end sketch\r\n\r\n      // ----- mount / resize / cleanup -----\r\n      requestAnimationFrame(() => {\r\n        if (!alive || !el.isConnected) return;\r\n\r\n        if (q5Ref.current) {\r\n          try { q5Ref.current.remove?.(); } catch {}\r\n          q5Ref.current = null;\r\n        }\r\n        let instance: any;\r\n        try { instance = new q5(sketch, el); }\r\n        catch (err) { console.error('[GameCanvas] q5 init error', err); return; }\r\n        q5Ref.current = instance;\r\n\r\n        if (pauseHiddenRef.current && 'IntersectionObserver' in window) {\r\n          io = new IntersectionObserver(([entry]) => {\r\n            visibleRef.current = entry.isIntersecting;\r\n            try {\r\n              if (entry.isIntersecting) q5Ref.current?.loop?.();\r\n              else q5Ref.current?.noLoop?.();\r\n            } catch {}\r\n          }, { threshold: 0.01 });\r\n          io.observe(el);\r\n        }\r\n\r\n        let ro: ResizeObserver | null = null;\r\n        const vv: VisualViewport | undefined = (window as any).visualViewport;\r\n        let lastW = 0, lastH = 0;\r\n\r\n        const resizeToHost = () => {\r\n          const host = hostRef.current;\r\n          const inst = q5Ref.current;\r\n          if (!host || !host.isConnected || !inst?.resizeCanvas) return;\r\n          const w = Math.max(1, Math.round(host.offsetWidth));\r\n          const h = Math.max(1, Math.round(host.offsetHeight));\r\n          if (w === lastW && h === lastH) return;\r\n          lastW = w; lastH = h;\r\n          try { inst.resizeCanvas(w, h); } catch (e) { console.warn('[GameCanvas] resize skipped', e); }\r\n        };\r\n\r\n        onResize = () => requestAnimationFrame(resizeToHost);\r\n        window.addEventListener('resize', onResize);\r\n\r\n        if ('ResizeObserver' in window) {\r\n          ro = new ResizeObserver(() => requestAnimationFrame(resizeToHost));\r\n          ro.observe(el);\r\n        }\r\n\r\n        window.addEventListener('orientationchange', onResize);\r\n        vv?.addEventListener('resize', onResize);\r\n        vv?.addEventListener('scroll', onResize);\r\n\r\n        const onFs = () => requestAnimationFrame(resizeToHost);\r\n        document.addEventListener('fullscreenchange', onFs);\r\n\r\n        requestAnimationFrame(resizeToHost);\r\n\r\n        cleanupRef.current = () => {\r\n          const instAny = q5Ref.current as any;\r\n          if (instAny && typeof instAny._pointerCleanup === 'function') {\r\n            try { instAny._pointerCleanup(); } catch {}\r\n          }\r\n          if (io) io.disconnect();\r\n          if (onResize) window.removeEventListener('resize', onResize);\r\n          document.removeEventListener('fullscreenchange', onFs);\r\n          ro?.disconnect();\r\n          vv?.removeEventListener('resize', onResize);\r\n          vv?.removeEventListener('scroll', onResize);\r\n          if (q5Ref.current?.remove) q5Ref.current.remove();\r\n          q5Ref.current = null;\r\n          el.replaceChildren();\r\n        };\r\n      });\r\n    });\r\n\r\n    return () => {\r\n      alive = false;\r\n      cleanupRef.current?.();\r\n      cleanupRef.current = null;\r\n    };\r\n  }, []); // run once\r\n\r\n  return <div className=\"evade-the-rock\" ref={hostRef} style={{ width: '100vw', height: '100dvh' }} />;\r\n}\r\n"],"names":["useEffect","useRef","useRealMobileViewport","jsx","_jsx","GameCanvas","onCoinsChange","highScore","onGameOver","onReady","pauseWhenHidden","demoMode","overlayActive","allowSpawns","hostRef","q5Ref","visibleRef","cleanupRef","coinsChangeRef","gameOverRef","readyRef","highScoreRef","pauseHiddenRef","demoRef","overlayRef","allowSpawnsRef","current","isRealMobile","alive","io","onResize","then","q5mod","q5","default","el","isConnected","replaceChildren","remove","sketch","p","verticalMode","rectangles","octagons","particles","projectiles","circle","lastSpawnTime","lastOctagonSpawnTime","rectangleSpawnRate","coins","gameOver","prevGameOver","lastDemoFlag","lastFiredTime","Infinity","cooldownDuration","cooldownRadiusMax","MAX_PARTICLES","MAX_PROJECTILES","MAX_RECTANGLES","dragPointerId","lastTouch","primaryCandidateId","primaryTapInfo","tapCandidates","Map","TAP_MS","TAP_MOVE","DRAG_PROMOTE","baseImpulse","movingUp","movingDown","movingLeft","movingRight","GOLD_COLORS","scratchXY","x","y","canSpawn","restartGame","length","Circle","height","millis","setup","w","offsetWidth","h","offsetHeight","pixelDensity","frameRate","createCanvas","style","touchAction","canvas","overscrollBehavior","webkitUserSelect","userSelect","getCanvasCoords","e","r","getBoundingClientRect","clientX","left","width","clientY","top","promoteToDrag","pointerId","setPointerCapture","onDown","x0","y0","t0","set","preventDefault","onMove","dx0","dy0","moved","Math","hypot","dx","dy","dist","speedFactor","log2","force","vx","vy","ti","get","tryFire","now","push","Projectile","splice","onUp","releasePointerCapture","dt","delete","onCancel","addEventListener","passive","_pointerCleanup","removeEventListener","window","innerWidth","innerHeight","color","restart","draw","demo","ax","ay","background","delta","deltaTime","nowMillis","vw","vh","stopHorizontal","stopVertical","autoEvade","moveUp","moveDown","moveLeft","moveRight","update","display","spawnRectangles","updateRectangles","spawnOctagons","updateOctagons","blendMode","ADD","i","part","isDead","BLEND","proj","isNewHigh","drawCooldownRing","pAny","elapsed","progress","radius","noStroke","fill","ellipse","evadeX","evadeY","danger","rect","cx","cy","distSq","sqrt","weight","attractX","attractY","target","reduce","a","b","da","size","db","d","inView","filter","maxRectangles","ww","wh","Shape","isNaN","overlaps","j","projSize","projX","projY","projW","projH","RectangleProjectile","random","burstRectangles","off","r1","r2","resolveCollision","k","angle","TWO_PI","speed","cos","sin","buffer","o","Particle","c","abs","numParticles","whole","floor","frac","keyPressed","key","keyCode","UP_ARROW","DOWN_ARROW","LEFT_ARROW","RIGHT_ARROW","keyReleased","constructor","trail","damp","pow","shift","lim","n","pos","map","other","isOctagon","sumR","max","min","rotation","rotationSpeed","startOff","isOct","vertical","GOLD","reset","baseX","translate","rotate","radians","drawOctagon","rectMode","CENTER","pop","step","beginShape","ang","px","py","vertex","endShape","CLOSE","w1","h1","w2","h2","overlapX","overlapY","lifespan","srcVx","srcVy","mul","srcSpeed","constrain","levels","minSpeed","maxSpeed","targetSpeed","acceleration","mag","ux","uy","alpha","t","factor","maxLifespan","requestAnimationFrame","instance","err","console","error","IntersectionObserver","entry","isIntersecting","loop","noLoop","threshold","observe","ro","vv","visualViewport","lastW","lastH","resizeToHost","host","inst","resizeCanvas","round","warn","ResizeObserver","onFs","document","instAny","disconnect","className","ref"],"sourceRoot":""}