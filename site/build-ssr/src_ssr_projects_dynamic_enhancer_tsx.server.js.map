{"version":3,"file":"src_ssr_projects_dynamic_enhancer_tsx.server.js","mappings":"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","sources":["webpack://personal-site/./src/ssr/projects/dynamic.enhancer.tsx","webpack://personal-site/./src/utils/content-utility/dynamic-overlay.ts","webpack://personal-site/./src/utils/content-utility/real-mobile.ts","webpack://personal-site/./src/utils/loading/loading-hub.tsx"],"sourcesContent":["// src/ssr/projects/dynamic.enhancer.tsx\r\nimport React, { useEffect, useLayoutEffect, useRef, useState } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { useDynamicOverlay } from '../../utils/content-utility/dynamic-overlay';\r\nimport { useRealMobileViewport } from '../../utils/content-utility/real-mobile';\r\nimport LoadingHub from '../../utils/loading/loading-hub';\r\n\r\ntype ShadowInboundProps = { onFocusChange?: (f: boolean) => void; onReady?: () => void };\r\ntype ShadowInboundType = React.ComponentType<ShadowInboundProps>;\r\n\r\nfunction scheduleIdle(cb: () => void, timeout = 2000): () => void {\r\n  const w = window as unknown as {\r\n    requestIdleCallback?: (cb: IdleRequestCallback, opts?: { timeout?: number }) => number;\r\n    cancelIdleCallback?: (id: number) => void;\r\n  };\r\n  if (typeof w.requestIdleCallback === 'function') {\r\n    const id = w.requestIdleCallback(cb as unknown as IdleRequestCallback, { timeout });\r\n    return () => w.cancelIdleCallback?.(id);\r\n  }\r\n  const t = window.setTimeout(cb, timeout);\r\n  return () => window.clearTimeout(t);\r\n}\r\n\r\nconst DynamicEnhancer: React.FC = () => {\r\n  // locate SSR nodes\r\n  const frameRef = useRef<HTMLElement | null>(null);\r\n  const [overlayEl, setOverlayEl] = useState<HTMLElement | null>(null);\r\n\r\n  useLayoutEffect(() => {\r\n    const img = document.getElementById('dynamic-device-frame') as HTMLElement | null;\r\n    frameRef.current = img;\r\n    const overlay = img?.closest('.device-wrapper')?.querySelector('.screen-overlay') as HTMLElement | null;\r\n    setOverlayEl(overlay ?? null);\r\n  }, []);\r\n\r\n  // compute overlay sizing\r\n  const overlaySize = useDynamicOverlay(frameRef);\r\n  const isRealMobile = useRealMobileViewport();\r\n\r\n  useEffect(() => {\r\n    if (!overlayEl) return;\r\n    const isPhone = window.matchMedia('(max-width: 767.98px)').matches;\r\n\r\n    if (isPhone) {\r\n      overlayEl.style.width = `${overlaySize.width}px`;\r\n      overlayEl.style.height = isRealMobile\r\n        ? `${overlaySize.heightSet1}svh`\r\n        : `${overlaySize.heightSet2}px`;\r\n    } else {\r\n      overlayEl.style.removeProperty('width');\r\n      overlayEl.style.removeProperty('height');\r\n    }\r\n  }, [overlayEl, overlaySize.width, overlaySize.heightSet1, overlaySize.heightSet2, isRealMobile]);\r\n\r\n  // gate mounting of shadow app\r\n  const [shouldMountShadow, setShouldMountShadow] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const container = document.getElementById('block-dynamic');\r\n    if (!container) { setShouldMountShadow(true); return; }\r\n\r\n    const io = new IntersectionObserver(\r\n      ([entry]) => {\r\n        if (entry.intersectionRatio >= 0.3) {\r\n          setShouldMountShadow(true);\r\n          io.disconnect();\r\n        }\r\n      },\r\n      { threshold: [0, 0.3] }\r\n    );\r\n    io.observe(container);\r\n\r\n    const cancel = scheduleIdle(() => setShouldMountShadow(true), 2000);\r\n    return () => { io.disconnect(); cancel(); };\r\n  }, []);\r\n\r\n  // lazy import + portal\r\n  const [ShadowInbound, setShadowInbound] = useState<ShadowInboundType | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!shouldMountShadow) return;\r\n    let alive = true;\r\n    import('../../dynamic-app/dynamic-app-shadow.jsx')\r\n      .then(m => { if (alive) setShadowInbound(() => m.default as ShadowInboundType); })\r\n      .catch(err => console.warn('[DynamicEnhancer] shadow import failed:', err));\r\n    return () => { alive = false; };\r\n  }, [shouldMountShadow]);\r\n\r\n  // manage loader visibility\r\n  const [showLoader, setShowLoader] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const onHydrated = () => setShowLoader(false);\r\n    window.addEventListener('dynamic-app:hydrated', onHydrated as EventListener);\r\n    return () => window.removeEventListener('dynamic-app:hydrated', onHydrated as EventListener);\r\n  }, []);\r\n\r\n  if (!overlayEl) return null;\r\n\r\n  const handleReady = () => {\r\n    setShowLoader(false);\r\n    window.dispatchEvent(new CustomEvent('dynamic-app:hydrated'));\r\n  };\r\n\r\n  return createPortal(\r\n    <>\r\n      {showLoader && (\r\n        <LoadingHub\r\n          keyword=\"dynamic\"\r\n          lines={[\r\n            \"Mounting dynamic app…\",\r\n            \"Loading interactive media…\",\r\n            \"Almost ready…\"\r\n          ]}\r\n          minHeight={200}\r\n          cycleMs={1500}\r\n          animMs={800}\r\n        />\r\n      )}\r\n      {ShadowInbound && shouldMountShadow && (\r\n        <ShadowInbound onFocusChange={() => {}} onReady={handleReady} />\r\n      )}\r\n    </>,\r\n    overlayEl\r\n  );\r\n};\r\n\r\nexport default DynamicEnhancer;\r\n","import { useEffect, useState } from 'react';\r\n\r\nexport function useDynamicOverlay(frameRef: React.RefObject<HTMLElement>) {\r\n  const [style, setStyle] = useState<{\r\n    width: number;\r\n    heightSet1: number;\r\n    heightSet2: number;\r\n  }>({\r\n    width: 0,\r\n    heightSet1: 0,\r\n    heightSet2: 0,\r\n  });\r\n\r\n  useEffect(() => {\r\n    const update = () => {\r\n      if (!frameRef.current) return;\r\n\r\n      const rect = frameRef.current.getBoundingClientRect();\r\n      const aspect = rect.width / rect.height;\r\n\r\n      // Aspect ratio breakpoints\r\n      const minAspect = 1.5 / 6.5; // ~0.2307\r\n      const maxAspect = 3.3 / 6.5; // ~0.5077\r\n\r\n      // Width range (shared)\r\n      const minWidth = 150;\r\n      const maxWidth = 320;\r\n\r\n      // Height range set 1 (your current svh-based values)\r\n      const minHeightSet1 = 63;\r\n      const maxHeightSet1 = 93;\r\n\r\n      // Height range set 2 (original px-based)\r\n      const minHeightSet2 = 280;\r\n      const maxHeightSet2 = 610;\r\n\r\n      // --- Aspect ratio-based lerp ---\r\n      let width: number;\r\n      let height1: number;\r\n      let height2: number;\r\n\r\n      if (aspect <= minAspect) {\r\n        width = minWidth;\r\n        height1 = minHeightSet1;\r\n        height2 = minHeightSet2;\r\n      } else if (aspect >= maxAspect) {\r\n        width = maxWidth;\r\n        height1 = maxHeightSet1;\r\n        height2 = maxHeightSet2;\r\n      } else {\r\n        const t = (aspect - minAspect) / (maxAspect - minAspect);\r\n        width = minWidth + (maxWidth - minWidth) * t;\r\n        height1 = minHeightSet1 + (maxHeightSet1 - minHeightSet1) * t;\r\n        height2 = minHeightSet2 + (maxHeightSet2 - minHeightSet2) * t;\r\n      }\r\n\r\n      // --- Absolute height multiplier (0 → 2 over 0–1300px) ---\r\n      const minFrameHeight = 0;\r\n      const maxFrameHeight = 1300;\r\n      const minMultiplier = 0;\r\n      const maxMultiplier = 2;\r\n\r\n      const clampedHeight = Math.min(Math.max(rect.height, minFrameHeight), maxFrameHeight);\r\n      const heightT = (clampedHeight - minFrameHeight) / (maxFrameHeight - minFrameHeight);\r\n      const heightMultiplier = minMultiplier + (maxMultiplier - minMultiplier) * heightT;\r\n\r\n      // Apply multiplier\r\n      width *= heightMultiplier;\r\n      height1 *= heightMultiplier;\r\n      height2 *= heightMultiplier;\r\n\r\n      setStyle({\r\n        width,\r\n        heightSet1: height1,\r\n        heightSet2: height2,\r\n      });\r\n    };\r\n\r\n    update();\r\n    window.addEventListener('resize', update);\r\n    window.addEventListener('orientationchange', update);\r\n    return () => {\r\n      window.removeEventListener('resize', update);\r\n      window.removeEventListener('orientationchange', update);\r\n    };\r\n  }, [frameRef]);\r\n\r\n  return style; // { width, heightSet1, heightSet2 }\r\n}\r\n","// useRealMobileViewport.ts\r\nimport { useEffect, useState } from 'react';\r\n\r\nexport function useRealMobileViewport() {\r\n  const [isRealMobile, setIsRealMobile] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const checkMobile = () => {\r\n      const touch = navigator.maxTouchPoints > 0;\r\n      const coarse = window.matchMedia?.('(pointer: coarse)').matches ?? false;\r\n      const width = window.innerWidth;\r\n      const ua = navigator.userAgent || navigator.vendor || (window as any).opera;\r\n\r\n      // iOS detection (iPhone / iPad)\r\n      const isIOS = /iPad|iPhone|iPod/.test(ua) ||\r\n        (navigator.platform === 'MacIntel' && touch); // iPadOS pretends to be Mac\r\n\r\n      // Android detection\r\n      const isAndroid = /Android/.test(ua);\r\n\r\n      // Consider it real mobile if:\r\n      // - Touch exists, and viewport is small, or\r\n      // - Known mobile UA\r\n      const realMobile =\r\n        (touch && width <= 1024) ||\r\n        isIOS ||\r\n        isAndroid ||\r\n        coarse;\r\n\r\n      setIsRealMobile(realMobile);\r\n    };\r\n\r\n    checkMobile();\r\n    window.addEventListener('resize', checkMobile);\r\n    window.addEventListener('orientationchange', checkMobile);\r\n\r\n    return () => {\r\n      window.removeEventListener('resize', checkMobile);\r\n      window.removeEventListener('orientationchange', checkMobile);\r\n    };\r\n  }, []);\r\n\r\n  return isRealMobile;\r\n}\r\n","import React, { useEffect, useMemo, useRef, useState } from 'react';\r\nimport '../../styles/loading-hub.css';\r\n\r\ntype LoadingHubProps = {\r\n  keyword?: string;\r\n  lines?: string[];\r\n  /** Fixed height so layout doesn’t jump */\r\n  minHeight?: number | string;\r\n  /** Extra className to theme per block */\r\n  className?: string;\r\n  /** ARIA label for screen readers */\r\n  ariaLabel?: string;\r\n  /** Optional % if you fake/stream progress */\r\n  progress?: number | null;\r\n  /** Full cycle time per line (ms) */\r\n  cycleMs?: number;\r\n  /** Animation length inside that cycle (ms) */\r\n  animMs?: number;\r\n};\r\n\r\nexport default function LoadingHub({\r\n  keyword,\r\n  lines = ['Loading…'],\r\n  minHeight = 160,\r\n  className = '',\r\n  ariaLabel = 'Loading',\r\n  progress = null,\r\n  cycleMs = 1400,\r\n  animMs = 900,\r\n}: LoadingHubProps) {\r\n  const [lineIndex, setLineIndex] = useState(0);\r\n\r\n  // rotate through provided lines (no-op if only one)\r\n  const hasMultiple = lines.length > 1;\r\n  useEffect(() => {\r\n    if (!hasMultiple) return;\r\n    const t = setInterval(() => {\r\n      setLineIndex((i) => (i + 1) % lines.length);\r\n    }, cycleMs);\r\n    return () => clearInterval(t);\r\n  }, [hasMultiple, lines.length, cycleMs]);\r\n\r\n  // Avoid reflow: lock container height\r\n  const style = useMemo<React.CSSProperties>(() => {\r\n    const h = typeof minHeight === 'number' ? `${minHeight}px` : (minHeight ?? 'auto');\r\n    return { minHeight: h };\r\n  }, [minHeight]);\r\n\r\n  // SR-only progressive percent\r\n  const srRef = useRef<HTMLSpanElement>(null);\r\n  useEffect(() => {\r\n    if (progress == null || !srRef.current) return;\r\n    srRef.current.textContent = `${Math.round(progress)}%`;\r\n  }, [progress]);\r\n\r\n  return (\r\n    <div\r\n      className={`loading-hub loading-hub--text ${className || ''}`}\r\n      style={style}\r\n      role=\"status\"\r\n      aria-live=\"polite\"\r\n      aria-label={ariaLabel}\r\n      data-keyword={keyword || undefined}\r\n      // expose anim timing to CSS\r\n      data-anim-ms={animMs}\r\n    >\r\n      <div className=\"loading-hub__copy\" aria-hidden={false}>\r\n        {/* key forces re-mount so the animation restarts */}\r\n        <h2 key={lineIndex} className=\"loading-hub__line\">\r\n          {lines[lineIndex]}\r\n        </h2>\r\n\r\n        {progress != null && (\r\n          <div className=\"loading-hub__progress\" aria-hidden=\"true\">\r\n            {Math.round(progress)}%\r\n          </div>\r\n        )}\r\n\r\n        {/* SR-only percent, updates without layout */}\r\n        <span className=\"sr-only\" ref={srRef} />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["React","useEffect","useLayoutEffect","useRef","useState","createPortal","useDynamicOverlay","useRealMobileViewport","LoadingHub","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","scheduleIdle","cb","timeout","w","window","requestIdleCallback","id","cancelIdleCallback","t","setTimeout","clearTimeout","DynamicEnhancer","frameRef","overlayEl","setOverlayEl","img","document","getElementById","current","overlay","closest","querySelector","overlaySize","isRealMobile","isPhone","matchMedia","matches","style","width","height","heightSet1","heightSet2","removeProperty","shouldMountShadow","setShouldMountShadow","container","io","IntersectionObserver","entry","intersectionRatio","disconnect","threshold","observe","cancel","ShadowInbound","setShadowInbound","alive","then","m","default","catch","err","console","warn","showLoader","setShowLoader","onHydrated","addEventListener","removeEventListener","handleReady","dispatchEvent","CustomEvent","children","keyword","lines","minHeight","cycleMs","animMs","onFocusChange","onReady","setStyle","update","rect","getBoundingClientRect","aspect","minAspect","maxAspect","minWidth","maxWidth","minHeightSet1","maxHeightSet1","minHeightSet2","maxHeightSet2","height1","height2","minFrameHeight","maxFrameHeight","minMultiplier","maxMultiplier","clampedHeight","Math","min","max","heightT","heightMultiplier","setIsRealMobile","checkMobile","touch","navigator","maxTouchPoints","coarse","innerWidth","ua","userAgent","vendor","opera","isIOS","test","platform","isAndroid","realMobile","useMemo","className","ariaLabel","progress","lineIndex","setLineIndex","hasMultiple","length","setInterval","i","clearInterval","h","srRef","textContent","round","role","undefined","ref"],"sourceRoot":""}